# üöÄ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Contract AI System v2.0 (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô)

**–í–µ—Ä—Å–∏—è:** 2.1 (—Å —É—á–µ—Ç–æ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π)
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-09
**–û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 20 –Ω–µ–¥–µ–ª—å (5 —ç—Ç–∞–ø–æ–≤)
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## üìä –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∞

```
Stage 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞           [–ù–µ–¥–µ–ª–∏ 1-2]   ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 10%
Stage 1: Post-Execution MVP       [–ù–µ–¥–µ–ª–∏ 3-6]   ‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 30%
Stage 2: Pre-Execution            [–ù–µ–¥–µ–ª–∏ 7-10]  ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 40%
Stage 3: Smart Router Production  [–ù–µ–¥–µ–ª–∏ 11-14] ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà 60%
Stage 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ + UI          [–ù–µ–¥–µ–ª–∏ 15-20] ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 100%
```

---

## üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –í–°–ï–• —ç—Ç–∞–ø–æ–≤

1. **UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –î–ª—è –ö–ê–ñ–î–û–ì–û Stage —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º + –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
2. **–ß–µ–ª–æ–≤–µ–∫ –≤ —Ü–∏–∫–ª–µ:** –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã - —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è:** –°–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è, –Ω–æ –∏ —Å–≤–æ–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
4. **–ê–¥–º–∏–Ω-–∫–æ–Ω—Å–æ–ª—å:** Streamlit dashboard + –æ—Å–Ω–æ–≤–Ω–æ–π UI —Å –º–∞–∫—Å–∏–º—É–º–æ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
5. **RAG –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ:** RAG –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## ü§ñ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –º–æ–¥–µ–ª–µ–π

| –ú–æ–¥–µ–ª—å | –†–æ–ª—å | –°—Ç–æ–∏–º–æ—Å—Ç—å (–≤—Ö–æ–¥) | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|--------|------|------------------|------------|
| **DeepSeek-V3** | Primary Worker | $0.14 / 1M —Ç–æ–∫–µ–Ω–æ–≤ | 90% –∑–∞–¥–∞—á, –æ—Å–Ω–æ–≤–Ω–æ–π worker |
| **Claude 4.5 Sonnet** | Expert Fallback | $3.00 / 1M —Ç–æ–∫–µ–Ω–æ–≤ | –°–ª–æ–∂–Ω—ã–µ —Å–∫–∞–Ω—ã, –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, Vision |
| **GPT-4o** | Reserve Channel | $2.50 / 1M —Ç–æ–∫–µ–Ω–æ–≤ | –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ |
| **GPT-4o-mini** | Testing & Validation | $0.15 / 1M —Ç–æ–∫–µ–Ω–æ–≤ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |

**–ó–∞—á–µ–º GPT-4o-mini:**
- –î–µ—à–µ–≤–∞—è, –Ω–æ —É–º–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞
- –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –±–æ–ª—å—à–∏—Ö –∑–∞—Ç—Ä–∞—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π

---

## üéõÔ∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ UI:

### 1. –ü–æ–ª–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (Production Mode)
- –í—Å–µ –º–æ–¥—É–ª–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π —Å –≤—ã—Å–æ–∫–∏–º –ø–æ—Ç–æ–∫–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (Economy Mode)
- –ú–æ–¥—É–ª–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏
- –≠—Ç–∞–ø –ø—Ä–æ—à–µ–ª ‚Üí –º–æ–¥—É–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è ‚Üí —Å–ª–µ–¥—É—é—â–∏–π –≤–∫–ª—é—á–∏–ª—Å—è
- –î–ª—è –º–∞–ª—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π —Å –Ω–µ–±–æ–ª—å—à–∏–º –ø–æ—Ç–æ–∫–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

### 3. –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º (Custom Mode)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –≤–∫–ª—é—á–∏—Ç—å
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

---

## üîç RAG Strategy

RAG (Retrieval-Augmented Generation) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä:

1. **Pre-Execution:**
   - –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ best practices –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—à–ª—ã—Ö –∫–µ–π—Å–æ–≤

2. **Post-Execution:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –∏ —Ñ–æ—Ä–º—É–ª

3. **Risk Scoring:**
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤ (–∫–∞–∫–∏–µ —Ä–∏—Å–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–ª–∏—Å—å)
   - –û—Ç—Ä–∞—Å–ª–µ–≤—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ RAG:**
- **Vector Store:** pgvector (–¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤) + ChromaDB (–¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
- **Embedding Model:** text-embedding-3-small –∏–ª–∏ multilingual-e5-large
- **Retrieval:** Hybrid search (semantic + keyword)

---

# Stage 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ù–µ–¥–µ–ª–∏ 1-2)

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, API –∫–ª—é—á–∏, –±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.

## –ó–∞–¥–∞—á–∏

### 0.1 –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–î–µ–Ω—å 1-3)

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `alembic/versions/002_create_contracts_core.py` - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
- `alembic/versions/003_create_related_tables.py` - –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `alembic/versions/004_enable_pgvector.py` - –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- `alembic/versions/005_create_system_config.py` - –¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–æ–≤

**–¢–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**

```sql
1. contracts_core
   - id (UUID, PK)
   - doc_number (VARCHAR(100), NOT NULL, UNIQUE)
   - signed_date (DATE)
   - status (VARCHAR(20), CHECK IN 'negotiating'/'active'/'closed')
   - total_amount (NUMERIC(15,2))
   - currency (CHAR(3), DEFAULT 'RUB')
   - attributes (JSONB) -- –ì–∏–±–∫–∏–µ –ø–æ–ª—è
   - raw_data (JSONB)   -- –ü–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç IDP
   - embedding (vector(1536)) -- –î–ª—è –ø–æ–∏—Å–∫–∞
   - created_at, updated_at (TIMESTAMP)

2. contract_parties
   - id (UUID, PK)
   - contract_id (UUID, FK ‚Üí contracts_core)
   - role (VARCHAR(20): 'client'/'supplier'/'guarantor')
   - name (VARCHAR(255))
   - inn (VARCHAR(12))
   - kpp (VARCHAR(9))
   - address (TEXT)

3. contract_items
   - id (UUID, PK)
   - contract_id (UUID, FK)
   - item_number (INTEGER)
   - description (TEXT)
   - quantity (NUMERIC(10,2))
   - unit (VARCHAR(20))
   - price (NUMERIC(15,2))

4. payment_schedule
   - id (UUID, PK)
   - contract_id (UUID, FK)
   - payment_type (VARCHAR(50): 'prepayment'/'postpayment'/'milestone')
   - amount (NUMERIC(15,2))
   - percent (NUMERIC(5,2))
   - due_date (DATE)

5. contract_rules
   - id (UUID, PK)
   - contract_id (UUID, FK)
   - rule_type (VARCHAR(50): 'penalty'/'sla'/'termination')
   - trigger_condition (TEXT)
   - formula (JSONB) -- { "rate": 0.001, "base": "total_amount", "cap": 0.1 }
   - original_text (TEXT)

6. negotiation_sessions
   - id (UUID, PK)
   - uploaded_doc_path (TEXT)
   - status (VARCHAR(20): 'analyzing'/'awaiting_approval'/'approved'/'rejected'/'archived')
   - template_id (UUID, nullable) -- –°—Å—ã–ª–∫–∞ –Ω–∞ —à–∞–±–ª–æ–Ω –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
   - risk_score (NUMERIC(3,2))
   - ai_recommendations (JSONB) -- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
   - created_at (TIMESTAMP)

7. disagreements
   - id (UUID, PK)
   - session_id (UUID, FK ‚Üí negotiation_sessions)
   - section (VARCHAR(100))
   - their_clause (TEXT)
   - our_standard (TEXT)
   - risk_level (VARCHAR(20): 'critical'/'high'/'medium'/'low')
   - suggested_wording (TEXT)
   - ai_recommendation (TEXT) -- –ù–û–í–û–ï: —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏
   - user_approved (BOOLEAN DEFAULT FALSE) -- –ù–û–í–û–ï: –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

8. system_config (–ù–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê)
   - id (UUID, PK)
   - config_key (VARCHAR(100), UNIQUE)
   - config_value (JSONB)
   - description (TEXT)
   - updated_at (TIMESTAMP)
   -- –•—Ä–∞–Ω–∏—Ç: —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RAG

9. user_approvals (–ù–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê)
   - id (UUID, PK)
   - entity_type (VARCHAR(50): 'negotiation'/'extraction'/'protocol')
   - entity_id (UUID) -- ID —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
   - action (VARCHAR(100): 'approve_protocol'/'reject_extraction'/'approve_digitization')
   - approved_by (VARCHAR(100)) -- User ID
   - approved_at (TIMESTAMP)
   - comment (TEXT)

10. knowledge_base (–ù–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –¥–ª—è RAG)
    - id (UUID, PK)
    - content_type (VARCHAR(50): 'best_practice'/'regulation'/'precedent')
    - title (VARCHAR(255))
    - content (TEXT)
    - embedding (vector(1536))
    - metadata (JSONB)
    - created_at (TIMESTAMP)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
psql -d contract_ai -c "\d contracts_core"
psql -d contract_ai -c "\d system_config"
psql -d contract_ai -c "SELECT * FROM pg_extension WHERE extname='vector';"
```

### 0.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∫–ª—é—á–µ–π (–î–µ–Ω—å 3-4)

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/config/llm_config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

```python
from pydantic_settings import BaseSettings

class LLMConfig(BaseSettings):
    # DeepSeek
    DEEPSEEK_API_KEY: str
    DEEPSEEK_BASE_URL: str = "https://api.deepseek.com/v1"
    DEEPSEEK_MODEL: str = "deepseek-v3"
    DEEPSEEK_MAX_TOKENS: int = 4096

    # Anthropic Claude
    ANTHROPIC_API_KEY: str
    ANTHROPIC_MODEL: str = "claude-4-5-sonnet-20250929"
    ANTHROPIC_MAX_TOKENS: int = 4096

    # OpenAI
    OPENAI_API_KEY: str
    OPENAI_MODEL: str = "gpt-4o"
    OPENAI_MODEL_MINI: str = "gpt-4o-mini"  # –ù–û–í–û–ï: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

    # Router Config
    ROUTER_DEFAULT_MODEL: str = "deepseek-v3"
    ROUTER_COMPLEXITY_THRESHOLD: float = 0.8

    # RAG Config
    RAG_ENABLED: bool = True
    RAG_TOP_K: int = 5
    RAG_SIMILARITY_THRESHOLD: float = 0.7

    class Config:
        env_file = ".env"
```

**–§–∞–π–ª `.env.example`:**
```bash
# LLM API Keys
DEEPSEEK_API_KEY=your_deepseek_key_here
ANTHROPIC_API_KEY=your_anthropic_key_here
OPENAI_API_KEY=your_openai_key_here

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/contract_ai

# RAG
RAG_ENABLED=true
RAG_TOP_K=5
```

### 0.3 –ë–∞–∑–æ–≤—ã–π Smart Router + RAG (–î–µ–Ω—å 4-5)

**–§–∞–π–ª:** `src/services/model_router.py`

```python
class ModelRouter:
    def __init__(self, rag_service: Optional[RAGService] = None):
        self.rag = rag_service

    def select_model(
        self,
        doc_complexity_score: float = 0.0,
        is_scanned_image: bool = False,
        force_model: Optional[str] = None,
        use_rag_context: bool = True
    ) -> str:
        """
        –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º RAG.

        Args:
            doc_complexity_score: 0.0-1.0, –æ—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            is_scanned_image: True –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç - —Å–∫–∞–Ω/—Ñ–æ—Ç–æ
            force_model: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
            use_rag_context: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ RAG –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

        Returns:
            –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        """
        if force_model:
            return force_model

        # RAG: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∏—Ö —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        if use_rag_context and self.rag:
            similar_docs = self.rag.find_similar_processed_docs(doc_complexity_score)
            if similar_docs:
                # –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –¥–µ—à–µ–≤–æ–π –º–æ–¥–µ–ª—å—é
                if all(doc["model"] == "deepseek-v3" and doc["success"] for doc in similar_docs):
                    return "deepseek-v3"

        if is_scanned_image and doc_complexity_score > 0.8:
            return "claude-4-5-sonnet"

        return "deepseek-v3"
```

### 0.4 RAG Service (–î–µ–Ω—å 5-6)

**–§–∞–π–ª:** `src/services/rag_service.py`

```python
class RAGService:
    def __init__(self, vector_store, embedding_model):
        self.vector_store = vector_store
        self.embedding_model = embedding_model

    async def retrieve_context(
        self,
        query: str,
        context_type: str,  # 'contract' | 'best_practice' | 'regulation'
        top_k: int = 5
    ) -> List[Dict]:
        """
        –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã.
        """
        embedding = await self.embedding_model.encode(query)

        results = await self.vector_store.search(
            embedding=embedding,
            filter={"content_type": context_type},
            top_k=top_k
        )

        return results

    async def filter_with_context(
        self,
        extracted_data: Dict,
        context: List[Dict]
    ) -> Dict:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
        """
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ç–∏–≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        # –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—É–ª –∏ –ø—Ä–∞–≤–∏–ª
        pass
```

### 0.5 System Config Service (–î–µ–Ω—å 6-7)

**–§–∞–π–ª:** `src/services/system_config_service.py`

```python
class SystemMode(Enum):
    FULL_LOAD = "full_load"          # –í—Å–µ –º–æ–¥—É–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    SEQUENTIAL = "sequential"         # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    MANUAL = "manual"                 # –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –º–æ–¥—É–ª–µ–π

class SystemConfigService:
    async def get_current_mode(self) -> SystemMode:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã."""
        config = await self.db.get_config("system_mode")
        return SystemMode(config["value"])

    async def set_mode(self, mode: SystemMode, enabled_modules: List[str] = None):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã."""
        await self.db.update_config("system_mode", {"value": mode.value})

        if mode == SystemMode.MANUAL and enabled_modules:
            await self.db.update_config("enabled_modules", {"modules": enabled_modules})

    async def is_module_enabled(self, module_name: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–∫–ª—é—á–µ–Ω –ª–∏ –º–æ–¥—É–ª—å."""
        mode = await self.get_current_mode()

        if mode == SystemMode.FULL_LOAD:
            return True
        elif mode == SystemMode.MANUAL:
            config = await self.db.get_config("enabled_modules")
            return module_name in config["modules"]
        else:  # SEQUENTIAL
            # –õ–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
            return await self._check_sequential_module(module_name)
```

### 0.6 Streamlit Admin Dashboard (–î–µ–Ω—å 7)

**–§–∞–π–ª:** `admin/streamlit_dashboard.py`

```python
import streamlit as st

st.set_page_config(page_title="Contract AI Admin", layout="wide")

# Sidebar: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
st.sidebar.title("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã")

mode = st.sidebar.selectbox(
    "–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã",
    ["–ü–æ–ª–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞", "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π", "–†—É—á–Ω–æ–π"]
)

if mode == "–†—É—á–Ω–æ–π":
    modules = st.sidebar.multiselect(
        "–í–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏",
        ["OCR", "Level1 Extraction", "LLM Extraction", "RAG Filter", "Validation"]
    )

# Main area: –ú–µ—Ç—Ä–∏–∫–∏
col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric("–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ", "1,234", "+12%")
with col2:
    st.metric("–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å", "$0.023", "-85%")
with col3:
    st.metric("Accuracy", "96.5%", "+2.3%")
with col4:
    st.metric("–û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è", "7", "‚ö†Ô∏è")

# –ì—Ä–∞—Ñ–∏–∫–∏
st.subheader("üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π")
# Pie chart: DeepSeek vs Claude vs GPT-4o

st.subheader("üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ –¥–Ω—è–º")
# Line chart: daily cost

st.subheader("üïí –î–æ–∫—É–º–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—â–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è")
# Table: —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ awaiting_approval
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Stage 0

- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞, –≤—Å–µ 10 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] pgvector —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å API –∫–ª—é—á–∞–º–∏ (DeepSeek + Anthropic + OpenAI)
- [ ] –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º API —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∫–ª—é—á–∞—è GPT-4o-mini)
- [ ] `ModelRouter` –≤—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å –ø–æ –ª–æ–≥–∏–∫–µ (—Å —É—á–µ—Ç–æ–º RAG)
- [ ] `RAGService` –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã
- [ ] `SystemConfigService` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã
- [ ] Streamlit dashboard –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** Streamlit —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è API –∏ —Ä–µ–∂–∏–º–æ–≤

**–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 1 –¥–µ–Ω—å
**–û–±—â–µ–µ –≤—Ä–µ–º—è Stage 0:** 2 –Ω–µ–¥–µ–ª–∏

---

# Stage 1: Post-Execution MVP (–ù–µ–¥–µ–ª–∏ 3-6)

**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∏—Ö –≤ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –¥–≤–æ–π–Ω–∏–∫–∏.

## –ó–∞–¥–∞—á–∏

### 1.1 Endpoint: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ù–µ–¥–µ–ª—è 3, –î–µ–Ω—å 1-3)

**–§–∞–π–ª:** `src/api/contracts/post_execution_routes.py`

```python
@router.post("/api/v1/contracts/digitize")
async def digitize_contract(
    file: UploadFile = File(...),
    force_model: Optional[str] = Query(None),
    request_approval: bool = Query(True),  # –ù–û–í–û–ï: —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏—è
    background_tasks: BackgroundTasks
):
    """
    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏.

    Args:
        file: PDF/DOCX —Ñ–∞–π–ª –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞
        force_model: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
        request_approval: –¢—Ä–µ–±–æ–≤–∞—Ç—å –ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î

    Returns:
        { "task_id": "uuid", "status": "processing" | "awaiting_approval" }
    """
```

### 1.2 Orchestrator —Å RAG –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ–º (–ù–µ–¥–µ–ª—è 3, –î–µ–Ω—å 3-7)

**–§–∞–π–ª:** `src/services/post_execution_orchestrator.py`

```python
class PostExecutionOrchestrator:
    def __init__(
        self,
        model_router: ModelRouter,
        llm_client: LLMClient,
        rag_service: RAGService,
        config_service: SystemConfigService
    ):
        self.router = model_router
        self.llm = llm_client
        self.rag = rag_service
        self.config = config_service

    async def process_document(
        self,
        file_path: str,
        force_model: Optional[str] = None,
        request_approval: bool = True
    ):
        """
        –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å RAG –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.

        –≠—Ç–∞–ø—ã:
        1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–µ—Å–ª–∏ –º–æ–¥—É–ª—å –≤–∫–ª—é—á–µ–Ω)
        2. Level 1: Regex/SpaCy extraction (–µ—Å–ª–∏ –º–æ–¥—É–ª—å –≤–∫–ª—é—á–µ–Ω)
        3. RAG: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        4. Level 2: LLM extraction (—á–µ—Ä–µ–∑ Router)
        5. RAG Filter: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (–µ—Å–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
        7. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding
        """
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
        mode = await self.config.get_current_mode()

        # Stage 1: Text Extraction (–µ—Å–ª–∏ –º–æ–¥—É–ª—å –≤–∫–ª—é—á–µ–Ω)
        if await self.config.is_module_enabled("ocr"):
            text = await self.extract_text(file_path)
        else:
            return {"status": "waiting", "reason": "OCR module disabled"}

        # Stage 2: Level 1 Extraction
        if await self.config.is_module_enabled("level1_extraction"):
            level1_data = self.extract_level1(text)

        # Stage 3: RAG - –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        similar_docs = await self.rag.retrieve_context(
            query=text[:500],  # –ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
            context_type="contract",
            top_k=5
        )

        # Stage 4: Select Model
        model = self.router.select_model(
            force_model=force_model,
            use_rag_context=True
        )

        # Stage 5: LLM Extraction —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ RAG
        prompt_with_context = self._build_prompt_with_rag(text, similar_docs)
        intermediate_json = await self.llm.extract_structured_data(
            prompt_with_context, model
        )

        # Stage 6: RAG Filter - –í–∞–ª–∏–¥–∞—Ü–∏—è
        validated_data = await self.rag.filter_with_context(
            extracted_data=intermediate_json,
            context=similar_docs
        )

        # Stage 7: –ó–∞–ø—Ä–æ—Å –æ–¥–æ–±—Ä–µ–Ω–∏—è (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
        if request_approval:
            approval_id = await self.create_approval_request(
                entity_type="extraction",
                data=validated_data
            )
            return {
                "status": "awaiting_approval",
                "approval_id": approval_id,
                "preview": validated_data
            }

        # Stage 8: Save to DB
        contract_id = await self.save_to_db(validated_data)

        # Stage 9: Generate embedding
        await self.generate_embedding(contract_id, text)

        return {"status": "completed", "contract_id": contract_id}
```

### 1.3 Approval Service (–ù–µ–¥–µ–ª—è 4, –î–µ–Ω—å 1-2)

**–§–∞–π–ª:** `src/services/approval_service.py`

```python
class ApprovalService:
    async def create_approval_request(
        self,
        entity_type: str,
        entity_id: UUID,
        data: Dict
    ) -> UUID:
        """–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ."""
        approval = UserApproval(
            entity_type=entity_type,
            entity_id=entity_id,
            action=f"approve_{entity_type}",
            status="pending",
            data_preview=data
        )
        await self.db.save(approval)
        return approval.id

    async def approve(
        self,
        approval_id: UUID,
        user_id: str,
        comment: Optional[str] = None
    ):
        """–û–¥–æ–±—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å."""
        approval = await self.db.get_approval(approval_id)
        approval.approved_by = user_id
        approval.approved_at = datetime.utcnow()
        approval.comment = comment
        approval.status = "approved"
        await self.db.update(approval)

        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
        await self.execute_approved_action(approval)

    async def reject(
        self,
        approval_id: UUID,
        user_id: str,
        reason: str
    ):
        """–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å."""
        approval = await self.db.get_approval(approval_id)
        approval.approved_by = user_id
        approval.comment = reason
        approval.status = "rejected"
        await self.db.update(approval)
```

### 1.4 UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Stage 1 (–ù–µ–¥–µ–ª—è 4, –î–µ–Ω—å 3-5)

**–§–∞–π–ª:** `admin/pages/1_Test_Post_Execution.py`

```python
import streamlit as st

st.title("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Post-Execution Pipeline")

# Upload section
uploaded_file = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä", type=["pdf", "docx"])

col1, col2 = st.columns(2)
with col1:
    force_model = st.selectbox("–ú–æ–¥–µ–ª—å", ["–ê–≤—Ç–æ", "DeepSeek-V3", "Claude 4.5", "GPT-4o-mini"])
with col2:
    request_approval = st.checkbox("–¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ", value=True)

if st.button("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É") and uploaded_file:
    with st.spinner("–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç..."):
        result = api_client.digitize_contract(
            file=uploaded_file,
            force_model=force_model if force_model != "–ê–≤—Ç–æ" else None,
            request_approval=request_approval
        )

    if result["status"] == "awaiting_approval":
        st.success("‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã! –û–∂–∏–¥–∞–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ.")

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        st.subheader("üìä –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
        st.json(result["preview"])

        col1, col2 = st.columns(2)
        with col1:
            if st.button("‚úÖ –û–¥–æ–±—Ä–∏—Ç—å"):
                api_client.approve(result["approval_id"])
                st.success("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î!")
        with col2:
            if st.button("‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å"):
                reason = st.text_input("–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è")
                api_client.reject(result["approval_id"], reason)
                st.warning("–û—Ç–∫–ª–æ–Ω–µ–Ω–æ")

    elif result["status"] == "completed":
        st.success(f"‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω! ID: {result['contract_id']}")

# –°–µ–∫—Ü–∏—è: RAG Context
st.subheader("üîç RAG Context (–ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)")
if uploaded_file:
    similar = api_client.get_similar_contracts(uploaded_file)
    for doc in similar:
        st.info(f"üìÑ {doc['doc_number']} - Similarity: {doc['score']:.2f}")
```

### 1.5-1.7 (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –ø–ª–∞–Ω—É, –Ω–æ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º RAG –∏ approval flow)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Stage 1

- [ ] Endpoint `/contracts/digitize` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PDF –∏ DOCX
- [ ] Level 1 Extractor –∏–∑–≤–ª–µ–∫–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] RAG Service –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- [ ] LLM Client –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ RAG –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- [ ] ApprovalService —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- [ ] **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** Streamlit —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç, —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å
- [ ] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–ª—è 3+ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ < $0.05 (—á–µ—Ä–µ–∑ DeepSeek)

**–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 3 –¥–Ω—è
**–û–±—â–µ–µ –≤—Ä–µ–º—è Stage 1:** 4 –Ω–µ–¥–µ–ª–∏

---

# Stage 2: Pre-Execution (–ù–µ–¥–µ–ª–∏ 7-10)

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è–º–∏.

## –ó–∞–¥–∞—á–∏

### 2.1-2.5 (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –ø–ª–∞–Ω—É)

### 2.6 AI Recommendations Engine (–ù–µ–¥–µ–ª—è 9, –î–µ–Ω—å 1-3) - –ù–û–í–û–ï

**–§–∞–π–ª:** `src/services/recommendations_engine.py`

```python
class RecommendationsEngine:
    def __init__(self, llm_client: LLMClient, rag_service: RAGService):
        self.llm = llm_client
        self.rag = rag_service

    async def generate_recommendations(
        self,
        disagreements: List[Disagreement],
        context: Dict
    ) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏.

        –ù–µ —Ç–æ–ª—å–∫–æ "—á—Ç–æ –Ω–µ —Ç–∞–∫", –Ω–æ –∏ "—á—Ç–æ –¥–µ–ª–∞—Ç—å".
        """
        recommendations = []

        for disagreement in disagreements:
            # RAG: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∫–µ–π—Å–æ–≤
            similar_cases = await self.rag.retrieve_context(
                query=disagreement.their_clause,
                context_type="precedent",
                top_k=3
            )

            # LLM: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            prompt = f"""
            –°–∏—Ç—É–∞—Ü–∏—è: –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –ø—Ä–µ–¥–ª–æ–∂–∏–ª —É—Å–ª–æ–≤–∏–µ: "{disagreement.their_clause}"
            –ù–∞—à —Å—Ç–∞–Ω–¥–∞—Ä—Ç: "{disagreement.our_standard}"
            –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: {disagreement.risk_level}

            –ü–æ—Ö–æ–∂–∏–µ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã:
            {self._format_precedents(similar_cases)}

            –ó–∞–¥–∞—á–∞: –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤.
            """

            recommendation = await self.llm.generate(
                prompt=prompt,
                model="gpt-4o-mini"  # –î–µ—à–µ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
            )

            recommendations.append({
                "disagreement_id": disagreement.id,
                "recommendation": recommendation,
                "precedents": similar_cases,
                "suggested_actions": [
                    "–ù–∞—Å—Ç–∞–∏–≤–∞—Ç—å –Ω–∞ –Ω–∞—à–µ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ",
                    "–ö–æ–º–ø—Ä–æ–º–∏—Å—Å: –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—É–º–º—ã",
                    "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è, –µ—Å–ª–∏ –¥–æ–±–∞–≤—è—Ç –ø—É–Ω–∫—Ç X"
                ]
            })

        return recommendations
```

### 2.7 –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π endpoint —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ (–ù–µ–¥–µ–ª—è 9, –î–µ–Ω—å 3-5)

```python
@router.get("/api/v1/negotiation/{session_id}/analysis")
async def get_negotiation_analysis(session_id: UUID):
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑: —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã.

    Returns:
        {
            "disagreements": [...],
            "ai_recommendations": [...],  # –ù–û–í–û–ï
            "overall_risk_score": 0.65,
            "status": "awaiting_approval"  # –ù–û–í–û–ï
        }
    """
```

### 2.8 UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Stage 2 (–ù–µ–¥–µ–ª—è 10) - –ù–û–í–û–ï

**–§–∞–π–ª:** `admin/pages/2_Test_Pre_Execution.py`

```python
st.title("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Pre-Execution (–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤)")

uploaded_draft = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞", type=["pdf", "docx"])
template = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è", ["–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)", "–î–æ–≥–æ–≤–æ—Ä —É—Å–ª—É–≥", "–ê–≥–µ–Ω—Ç—Å–∫–∏–π –¥–æ–≥–æ–≤–æ—Ä"])

if st.button("üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å") and uploaded_draft:
    with st.spinner("–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫..."):
        result = api_client.analyze_draft(uploaded_draft, template)

    st.metric("–û–±—â–∏–π —Ä–∏—Å–∫", f"{result['overall_risk_score']:.0%}",
              delta=f"{result['risk_level']}", delta_color="inverse")

    # –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
    st.subheader("‚ö†Ô∏è –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è")
    for d in result["disagreements"]:
        with st.expander(f"{d['section']} - {d['risk_level'].upper()}"):
            col1, col2 = st.columns(2)
            with col1:
                st.markdown("**–ò—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:**")
                st.text(d["their_clause"])
            with col2:
                st.markdown("**–ù–∞—à —Å—Ç–∞–Ω–¥–∞—Ä—Ç:**")
                st.text(d["our_standard"])

            st.markdown("**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:**")
            st.info(d["suggested_wording"])

    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ù–û–í–û–ï)
    st.subheader("üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã")
    for rec in result["ai_recommendations"]:
        st.success(rec["recommendation"])

        st.markdown("**–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**")
        for action in rec["suggested_actions"]:
            st.checkbox(action, key=action)

    # –ü—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã
    st.subheader("üìö –ü–æ—Ö–æ–∂–∏–µ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã")
    for prec in result["precedents"]:
        st.info(f"–î–æ–≥–æ–≤–æ—Ä {prec['doc_number']}: {prec['outcome']}")

    # –û–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    st.subheader("‚úÖ –û–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π")
    if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π"):
        protocol = api_client.generate_protocol(result["session_id"])
        st.download_button("üì• –°–∫–∞—á–∞—Ç—å DOCX", protocol, "protocol.docx")

        if st.button("‚úÖ –û–¥–æ–±—Ä–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É"):
            api_client.approve_protocol(result["session_id"])
            st.success("–ü—Ä–æ—Ç–æ–∫–æ–ª –æ–¥–æ–±—Ä–µ–Ω!")
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Stage 2

- [ ] –°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ClauseComparator –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
- [ ] RiskScorer –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
- [ ] **RecommendationsEngine –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤ (RAG)**
- [ ] **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** Streamlit —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ DOCX —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **–ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 2 –¥–Ω—è
**–û–±—â–µ–µ –≤—Ä–µ–º—è Stage 2:** 4 –Ω–µ–¥–µ–ª–∏

---

# Stage 3: Smart Router Production (–ù–µ–¥–µ–ª–∏ 11-14)

(–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –ø–ª–∞–Ω—É + UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 3.7 UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Stage 3 (–ù–µ–¥–µ–ª—è 14) - –ù–û–í–û–ï

**–§–∞–π–ª:** `admin/pages/3_Test_Model_Router.py`

```python
st.title("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Smart Model Router")

st.subheader("üî¨ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π")

uploaded_test_doc = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç", type=["pdf"])

if uploaded_test_doc:
    st.info("–ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ –í–°–ï –º–æ–¥–µ–ª–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è...")

    results = {}
    for model in ["deepseek-v3", "claude-4-5-sonnet", "gpt-4o", "gpt-4o-mini"]:
        with st.spinner(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ {model}..."):
            result = api_client.digitize_contract(uploaded_test_doc, force_model=model)
            results[model] = result

    # –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
    comparison_df = pd.DataFrame({
        "–ú–æ–¥–µ–ª—å": results.keys(),
        "–°—Ç–æ–∏–º–æ—Å—Ç—å": [r["cost"] for r in results.values()],
        "–í—Ä–µ–º—è (—Å–µ–∫)": [r["time"] for r in results.values()],
        "Confidence": [r["confidence"] for r in results.values()],
        "–¢–æ—á–Ω–æ—Å—Ç—å": [r["accuracy"] for r in results.values()]
    })

    st.dataframe(comparison_df)

    st.subheader("üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è")
    st.bar_chart(comparison_df.set_index("–ú–æ–¥–µ–ª—å")["–°—Ç–æ–∏–º–æ—Å—Ç—å"])
```

---

# Stage 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ + UI (–ù–µ–¥–µ–ª–∏ 15-20)

### 4.7 Unified Admin Console (–ù–µ–¥–µ–ª—è 19-20) - –ù–û–í–û–ï

**–§–∞–π–ª:** `admin/streamlit_main.py`

```python
st.set_page_config(page_title="Contract AI Admin Console", layout="wide")

# –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –º–∞–∫—Å–∏–º—É–º–æ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
st.title("üìä Contract AI System - Admin Console")

# Row 1: –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
col1, col2, col3, col4, col5 = st.columns(5)
with col1:
    st.metric("–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è", "47", "+8")
with col2:
    st.metric("–°—Ç–æ–∏–º–æ—Å—Ç—å/–¥–æ–∫", "$0.019", "-91%")
with col3:
    st.metric("–°—Ä–µ–¥–Ω–∏–π Confidence", "94.2%", "+1.2%")
with col4:
    st.metric("–û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è", "3", "‚ö†Ô∏è")
with col5:
    st.metric("–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤", "1,842", "+23")

# Row 2: –ì—Ä–∞—Ñ–∏–∫–∏
col1, col2 = st.columns(2)
with col1:
    st.subheader("üìà –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –¥–Ω—è–º")
    # Line chart
with col2:
    st.subheader("ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π")
    # Pie chart: DeepSeek 87% | Claude 10% | GPT-4o 3%

# Row 3: –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
st.subheader("‚öôÔ∏è –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã")
current_mode = api_client.get_system_mode()
st.info(f"–†–µ–∂–∏–º: {current_mode}")

new_mode = st.selectbox("–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º", ["–ü–æ–ª–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞", "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π", "–†—É—á–Ω–æ–π"])
if new_mode != current_mode:
    if st.button("–ü—Ä–∏–º–µ–Ω–∏—Ç—å"):
        api_client.set_system_mode(new_mode)
        st.success("–†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω!")

if new_mode == "–†—É—á–Ω–æ–π":
    enabled_modules = st.multiselect(
        "–í–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏",
        ["OCR", "Level1 Extraction", "LLM Extraction", "RAG Filter", "Validation"],
        default=["OCR", "LLM Extraction"]
    )
    if st.button("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–¥—É–ª–∏"):
        api_client.set_enabled_modules(enabled_modules)

# Row 4: –û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
st.subheader("‚è≥ –î–æ–∫—É–º–µ–Ω—Ç—ã, –æ–∂–∏–¥–∞—é—â–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è")
pending = api_client.get_pending_approvals()
for item in pending:
    with st.expander(f"{item['entity_type']}: {item['doc_number']}"):
        st.json(item["data_preview"])
        col1, col2 = st.columns(2)
        with col1:
            if st.button("‚úÖ –û–¥–æ–±—Ä–∏—Ç—å", key=f"approve_{item['id']}"):
                api_client.approve(item['id'])
                st.rerun()
        with col2:
            if st.button("‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å", key=f"reject_{item['id']}"):
                api_client.reject(item['id'])
                st.rerun()

# Row 5: RAG Statistics
st.subheader("üîç RAG Statistics")
rag_stats = api_client.get_rag_stats()
st.metric("–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ", rag_stats["total_docs"])
st.metric("–°—Ä–µ–¥–Ω–∏–π Similarity Score", f"{rag_stats['avg_similarity']:.2f}")

# Row 6: LLM Usage Breakdown
st.subheader("üí∞ –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM")
llm_usage = api_client.get_llm_usage_breakdown()
st.dataframe(llm_usage)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Stage 4

- [ ] Amendment flow —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1C —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **Unified Admin Console (Streamlit) —Å –º–∞–∫—Å–∏–º—É–º–æ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π**
- [ ] **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ UI**
- [ ] **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è**
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ä–æ–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] End-to-End —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

**–í—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 3 –¥–Ω—è
**–û–±—â–µ–µ –≤—Ä–µ–º—è Stage 4:** 6 –Ω–µ–¥–µ–ª—å

---

# üìä –†–µ–∑—é–º–µ –û–ë–ù–û–í–õ–ï–ù–ù–û–ì–û –ø–ª–∞–Ω–∞

## –ö–ª—é—á–µ–≤—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

1. **GPT-4o-mini** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –ö–ê–ñ–î–û–ì–û Stage (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)
3. **–ß–µ–ª–æ–≤–µ–∫ –≤ —Ü–∏–∫–ª–µ:** Approval flow –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
4. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ + –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è:** –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã, –Ω–æ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è
5. **RAG –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ:** –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏
6. **–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:** –ü–æ–ª–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ / –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π / –†—É—á–Ω–æ–π (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ UI)
7. **Unified Admin Console:** Streamlit dashboard —Å –º–∞–∫—Å–∏–º—É–º–æ–º –º–µ—Ç—Ä–∏–∫

## –ü–æ—á–µ–º—É SQLAlchemy?

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** Alembic –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã –ë–î
- **Type Safety:** –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –†–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ Python –æ–±—ä–µ–∫—Ç—ã –≤–º–µ—Å—Ç–æ —Å—ã—Ä–æ–≥–æ SQL
- **ORM Relationships:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏ (ForeignKey, One-to-Many)

## –¢–∞–±–ª–∏—Ü–∞ —Å –Ω–æ–≤—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| `system_config` | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π |
| `user_approvals` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `knowledge_base` | RAG: –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (best practices, regulations, precedents) |
| `disagreements.ai_recommendation` | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è |
| `negotiation_sessions.ai_recommendations` | –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ |

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∏–Ω–∞—Ç—å Stage 0?** üöÄ
