# –û—Ç—á—ë—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Contract-AI-System

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 16 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ 989cfd8
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** Claude Code (Sonnet 4.5)

---

## –†–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Contract-AI-System. –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏. –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –î–ï–ü–õ–û–Æ**

---

## –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ app.py ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –§–∞–π–ª app.py –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –≤–∞–ª–∏–¥–µ–Ω
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:**
```
‚úÖ streamlit
‚úÖ src.agents (–≤—Å–µ –∞–≥–µ–Ω—Ç—ã)
‚úÖ src.models (–≤—Å–µ –º–æ–¥–µ–ª–∏ –ë–î)
‚úÖ src.services (DocumentParser, LLMGateway)
‚úÖ src.utils.auth
‚úÖ config.settings
```

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ AgentResult –≤–æ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–∞—Ö ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå `disagreement_processor_agent.py:116-119` - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `data={}`
- ‚ùå `disagreement_processor_agent.py:128-131` - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `data={}`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –î–æ:
return AgentResult(
    success=False,
    error="Analysis not found"
)

# –ü–æ—Å–ª–µ:
return AgentResult(
    success=False,
    data={},
    error="Analysis not found"
)
```

**–ò—Ç–æ–≥:** –í—Å–µ AgentResult –≤—ã–∑–æ–≤—ã —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (permissions) ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

–í—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `src/utils/auth.py`:

| Permission | DEMO | FULL | VIP | ADMIN |
|------------|------|------|-----|-------|
| can_analyze_contracts | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| can_export_pdf | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| can_use_changes_analyzer | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| can_use_disagreements | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| can_use_onboarding | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| can_view_logs | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –∫–æ–¥–µ permissions –∏–º–µ—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ auth.py

---

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π –ë–î ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

–í—Å–µ 12 –º–æ–¥–µ–ª–µ–π SQLAlchemy –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –°—Ç–∞—Ç—É—Å |
|--------|---------|--------|
| User | users | ‚úÖ |
| Template | templates | ‚úÖ |
| Contract | contracts | ‚úÖ |
| AnalysisResult | analysis_results | ‚úÖ |
| ContractRisk | contract_risks | ‚úÖ |
| ContractRecommendation | contract_recommendations | ‚úÖ |
| ContractAnnotation | contract_annotations | ‚úÖ |
| Disagreement | disagreements | ‚úÖ |
| DisagreementObjection | disagreement_objections | ‚úÖ |
| ContractVersion | contract_versions | ‚úÖ |
| ContractChange | contract_changes | ‚úÖ |
| ChangeAnalysisResult | change_analysis_results | ‚úÖ |

---

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ DocumentParser ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã: lxml, python-docx, PyPDF2, pdfplumber
- ‚úÖ –ú–µ—Ç–æ–¥ `parse()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ DOCX/PDF
- ‚úÖ –ú–µ—Ç–æ–¥ `parse_docx()` - –ø–∞—Ä—Å–∏–Ω–≥ DOCX –≤ XML
- ‚úÖ –ú–µ—Ç–æ–¥ `parse_pdf()` - –ø–∞—Ä—Å–∏–Ω–≥ PDF –≤ XML
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (FileNotFoundError, ValueError)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è XML —Å declaration

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞ (–ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –û–û–û, –ê–û, –ò–ü)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Ä–∞–∑–¥–µ–ª—ã, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–¥–ª—è DOCX)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ tracked changes (–¥–ª—è DOCX)

---

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ LLMGateway ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- ‚úÖ Claude (Anthropic)
- ‚úÖ OpenAI (GPT-4)
- ‚úÖ Perplexity
- ‚úÖ YandexGPT
- ‚úÖ GigaChat (–°–±–µ—Ä)
- ‚úÖ DeepSeek
- ‚úÖ Qwen (Alibaba)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (tenacity)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –∏ text —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ temperature –∏ max_tokens
- ‚úÖ System prompts
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –∏ execute –º–µ—Ç–æ–¥–æ–≤ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

–í—Å–µ 6 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ execute –º–µ—Ç–æ–¥—ã:

| –ê–≥–µ–Ω—Ç | –§–∞–π–ª | execute() | –°—Ç–∞—Ç—É—Å |
|-------|------|-----------|--------|
| OnboardingAgent | onboarding_agent_full.py | ‚úÖ | ‚úÖ |
| ContractGeneratorAgent | contract_generator_agent.py | ‚úÖ | ‚úÖ |
| ContractAnalyzerAgent | contract_analyzer_agent.py | ‚úÖ | ‚úÖ |
| DisagreementProcessorAgent | disagreement_processor_agent.py | ‚úÖ | ‚úÖ |
| ChangesAnalyzerAgent | changes_analyzer_agent.py | ‚úÖ | ‚úÖ |
| QuickExportAgent | quick_export_agent.py | ‚úÖ | ‚úÖ |

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –í—Å–µ –∞–≥–µ–Ω—Ç—ã –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `BaseAgent`
- –í—Å–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `AgentResult` –∏–∑ –º–µ—Ç–æ–¥–∞ `execute()`
- –ï—Å—Ç—å fallback –Ω–∞ stubs —á–µ—Ä–µ–∑ try/except –≤ `__init__.py`

---

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ app_pages_improved.py ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü:
  - `page_generator_improved()`
  - `page_knowledge_base()`

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ #1: Missing data parameter in disagreement_processor_agent

**–§–∞–π–ª:** `src/agents/disagreement_processor_agent.py`
**–°—Ç—Ä–æ–∫–∏:** 116-119, 128-131
**–¢–∏–ø:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (TypeError at runtime)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–≤–∞ –≤—ã–∑–æ–≤–∞ `AgentResult()` —Å `success=False` –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `data`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `data={}` –≤ –æ–±–∞ –≤—ã–∑–æ–≤–∞.

**–ö–æ–º–º–∏—Ç:** 989cfd8

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 15+
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∞–≥–µ–Ω—Ç–æ–≤:** 6
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –º–æ–¥–µ–ª–µ–π –ë–î:** 12
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ LLM:** 7
- **–ù–∞–π–¥–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:** 2
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—à–∏–±–æ–∫:** 2
- **–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:** 8/8

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Å Claude/OpenAI
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

2. **UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Streamlit**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (DOCX, PDF)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ XML

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

4. **Unit —Ç–µ—Å—Ç—ã**
   - –°–æ–∑–¥–∞—Ç—å pytest —Ç–µ—Å—Ç—ã –¥–ª—è DocumentParser
   - –°–æ–∑–¥–∞—Ç—å mock —Ç–µ—Å—Ç—ã –¥–ª—è LLMGateway
   - –¢–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - –†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ (>10MB)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (>100 —Å—Ç—Ä–∞–Ω–∏—Ü)
   - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ SQL injection
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ rate limiting

7. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ä—É—Å—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–¥ –ø—Ä–æ—à—ë–ª **–≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **—Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏**.

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫:
- ‚úÖ –†—É—á–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏
- ‚úÖ –î–µ–ø–ª–æ—é –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ LLM API –∏ –∑–∞–≥—Ä—É–∑–∫–æ–π —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤.

---

**–ü–æ–¥–ø–∏—Å—å —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞:** Claude Code (Sonnet 4.5)
**–î–∞—Ç–∞:** 16.10.2025
**Git commit:** 989cfd8

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 16.10.2025 (–ö–æ–º–º–∏—Ç b11c11e)

### –ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ #2

**–§–∞–π–ª:** `app.py:330-338`
**–¢–∏–ø:** TypeError at runtime
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ Contract

#### –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ Contract –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:
- `user_id` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `assigned_to`)
- `content` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `meta_info`)
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è `file_name` –∏ `document_type`

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```python
# –î–æ:
contract = Contract(
    user_id=user_id,
    contract_type='unknown',
    status='uploaded',
    file_path=file_path,
    content=parsed_xml
)

# –ü–æ—Å–ª–µ:
contract = Contract(
    file_name=os.path.basename(file_path),
    file_path=file_path,
    document_type='contract',
    contract_type='unknown',
    status='uploaded',
    assigned_to=user_id,
    meta_info=parsed_xml
)
```

#### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏ Contract:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `file_name: String(255)` - –∏–º—è —Ñ–∞–π–ª–∞
- `file_path: Text` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `document_type: String(50)` - —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ (contract/disagreement/tracked_changes)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `id: String(36)` - UUID (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `contract_type: String(50)` - —Ç–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞
- `status: String(50)` - —Å—Ç–∞—Ç—É—Å (default='pending')
- `assigned_to: String(36)` - FK –Ω–∞ users.id
- `risk_level: String(20)` - —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
- `meta_info: Text` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ/XML –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- `upload_date, created_at, updated_at: DateTime` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

### –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã ‚úÖ

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

1. ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
2. ‚úÖ –í—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. ‚úÖ DocumentParser —Ä–∞–±–æ—Ç–∞–µ—Ç (parse, parse_docx, parse_pdf)
4. ‚úÖ LLMGateway —Ä–∞–±–æ—Ç–∞–µ—Ç (call, _call_claude)
5. ‚úÖ –í—Å–µ –∞–≥–µ–Ω—Ç—ã –∏–º–µ—é—Ç execute –º–µ—Ç–æ–¥—ã
6. ‚úÖ app.py —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

**–°—Ç–∞—Ç—É—Å:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ö–æ–º–º–∏—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –§–∞–π–ª | –¢–∏–ø –æ—à–∏–±–∫–∏ |
|--------|----------|------|------------|
| 989cfd8 | Missing data parameter | disagreement_processor_agent.py | TypeError (2 –º–µ—Å—Ç–∞) |
| b11c11e | Wrong Contract field names | app.py | TypeError |

**–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

**–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** 16.10.2025, –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã ‚úÖ

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 16.10.2025 (–ö–æ–º–º–∏—Ç 2df1a4d)

### –ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ #3

**–§–∞–π–ª:** `app.py:335`
**–¢–∏–ø:** sqlite3.IntegrityError - CHECK constraint failed
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

#### –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Contract –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å `'uploaded'`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

**CHECK constraint –º–æ–¥–µ–ª–∏ Contract:**
```python
status.in_(['pending', 'analyzing', 'reviewing', 'completed', 'error'])
```

**–û—à–∏–±–∫–∞ –ë–î:**
```
sqlite3.IntegrityError: CHECK constraint failed: check_contract_status
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç–∞—Ç—É—Å–æ–≤:

```python
# 1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
status='pending'

# 2. –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∞–Ω–∞–ª–∏–∑–∞
contract.status = 'analyzing'
st.session_state.db_session.commit()

# 3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
contract.status = 'completed'
st.session_state.db_session.commit()

# 4. –ü—Ä–∏ –æ—à–∏–±–∫–µ
contract.status = 'error'
st.session_state.db_session.commit()
```

#### –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `pending` | –î–æ–≥–æ–≤–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `analyzing` | –î–æ–≥–æ–≤–æ—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∞–Ω–∞–ª–∏–∑–∞ |
| `reviewing` | –î–æ–≥–æ–≤–æ—Ä –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ —É —é—Ä–∏—Å—Ç–∞ |
| `completed` | –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ |
| `error` | –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ |

---

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–æ–º–º–∏—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –§–∞–π–ª | –¢–∏–ø –æ—à–∏–±–∫–∏ |
|--------|----------|------|------------|
| 989cfd8 | Missing data parameter | disagreement_processor_agent.py | TypeError (2 –º–µ—Å—Ç–∞) |
| b11c11e | Wrong Contract field names | app.py | TypeError |
| 2df1a4d | Invalid status value | app.py | IntegrityError (CHECK constraint) |

**–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–∞)

**–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** 16.10.2025, –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ ‚úÖ
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ üöÄ

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 16.10.2025 (–ö–æ–º–º–∏—Ç 3f62341)

### –ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ #4

**–§–∞–π–ª—ã:** 
- `src/agents/contract_analyzer_agent.py`
- `src/agents/contract_generator_agent.py`
- `src/agents/disagreement_processor_agent.py`

**–¢–∏–ø:** AttributeError - 'object has no attribute'
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–º—ë–Ω –∞—Ç—Ä–∏–±—É—Ç–æ–≤ BaseAgent

#### –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:

–ê–≥–µ–Ω—Ç—ã –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º `self.db_session` –∏ `self.llm_gateway`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.

**–û—à–∏–±–∫–∞:**
```
AttributeError: 'ContractAnalyzerAgent' object has no attribute 'db_session'
```

**–ü—Ä–∏—á–∏–Ω–∞:**
BaseAgent –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏:
```python
class BaseAgent:
    def __init__(self, llm_gateway, db_session, config=None):
        self.llm = llm_gateway      # –ù–ï self.llm_gateway
        self.db = db_session         # –ù–ï self.db_session
        self.config = config or {}
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã:

| –§–∞–π–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|------|-------------|
| contract_analyzer_agent.py | 14x `self.db_session`‚Üí`self.db`, 4x `self.llm_gateway`‚Üí`self.llm` |
| contract_generator_agent.py | 1x `self.db_session`‚Üí`self.db` |
| disagreement_processor_agent.py | 1x `self.llm_gateway`‚Üí`self.llm` |

**–í—Å–µ–≥–æ:** 20 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ 3 —Ñ–∞–π–ª–∞—Ö

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã BaseAgent:

```python
self.llm           # LLMGateway instance
self.db            # SQLAlchemy Session
self.config        # Configuration dict
self.execution_history  # Execution log
```

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| # | –ö–æ–º–º–∏—Ç | –§–∞–π–ª(—ã) | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–∏–ø –æ—à–∏–±–∫–∏ |
|---|--------|---------|----------|------------|
| 1 | 989cfd8 | disagreement_processor_agent.py | Missing data={} –≤ AgentResult (2 –º–µ—Å—Ç–∞) | TypeError |
| 2 | b11c11e | app.py | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è Contract (user_id, content, file_name, document_type) | TypeError |
| 3 | 2df1a4d | app.py | –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å—Ç–∞—Ç—É—Å 'uploaded' | IntegrityError |
| 4 | 3f62341 | 3 agent files | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã BaseAgent (20 –º–µ—Å—Ç) | AttributeError |

**–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 25 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö

**–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** 16.10.2025, –≤—Å–µ –∞–≥–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** üöÄ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
