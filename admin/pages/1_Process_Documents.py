"""
–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ - "–°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —è—â–∏–∫"
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
"""

import streamlit as st
import sys
from pathlib import Path
import asyncio
import json
import os
import tempfile
import pandas as pd
from typing import Dict, Any

# Add project root to path
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

st.set_page_config(
    page_title="–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ - Contract AI",
    page_icon="üìÑ",
    layout="wide"
)

st.title("üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")
st.markdown("**–°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —è—â–∏–∫:** –≤–∏–¥–Ω—ã –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã")

st.markdown("---")

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
st.header("1Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞")

uploaded_file = st.file_uploader(
    "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–æ–≥–æ–≤–æ—Ä–∞",
    type=['pdf', 'docx', 'txt', 'png', 'jpg', 'jpeg'],
    help="–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: PDF, DOCX, TXT, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å OCR)"
)

# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è async –æ–±—Ä–∞–±–æ—Ç–∫–∏
async def process_document_async(file_path, file_ext):
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
    from src.services.document_processor import DocumentProcessor
    import os

    openai_api_key = os.getenv("OPENAI_API_KEY")
    if not openai_api_key:
        raise ValueError("OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")

    processor = DocumentProcessor(
        openai_api_key=openai_api_key,
        use_rag=True,
        use_section_analysis=True  # –í–∫–ª—é—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤
    )
    result = await processor.process_document(file_path, file_ext)
    return result


def get_optimal_model_info(stage: str) -> tuple[str, str]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è —ç—Ç–∞–ø–∞"""
    models = {
        "text_extraction": (
            "N/A (–ø—Ä—è–º–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ)",
            "pdfplumber + PaddleOCR –¥–ª—è —Å–∫–∞–Ω–æ–≤ + LayoutLMv3 –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–∞–∫–µ—Ç–æ–≤"
        ),
        "level1": (
            "regex + SpaCy (ru_core_news_sm)",
            "SpaCy ru_core_news_lg, DeepPavlov NER, –∏–ª–∏ Qwen2.5-VL-72B –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"
        ),
        "llm": (
            "gpt-4o-mini ($0.15/1M –≤—Ö–æ–¥)",
            "Claude 4.5 Sonnet ($3/1M) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤, DeepSeek-R1 ($0.28/1M) –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏, Qwen3-235B-A22B –¥–ª—è –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã—Ö"
        ),
        "rag": (
            "pgvector + text-embedding-ada-002",
            "OpenAI text-embedding-3-large –∏–ª–∏ Cohere embed-multilingual-v3.0 –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∏ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤"
        ),
        "validation": (
            "Business rules + Pydantic",
            "Claude 4.5 Sonnet ($3/1M) –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, Qwen3-235B-A22B –¥–ª—è –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤"
        )
    }
    return models.get(stage, ("N/A", "N/A"))


def display_validation_section(section_analysis_data: Dict[str, Any]):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–≥–æ–≤–æ—Ä–∞ (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò)"""

    if not section_analysis_data:
        st.warning("–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–µ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω")
        return

    st.subheader("üìã –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–≥–æ–≤–æ—Ä–∞")

    sections = section_analysis_data.get("sections", [])
    section_analyses = section_analysis_data.get("section_analyses", [])
    complex_analysis = section_analysis_data.get("complex_analysis")

    if not sections:
        st.warning("–†–∞–∑–¥–µ–ª—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤ –¥–æ–≥–æ–≤–æ—Ä–µ")
        return

    st.info(f"**–ù–∞–π–¥–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤:** {len(sections)} | **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏ ‚Üí 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG –±–∞–∑–µ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞) ‚Üí 3Ô∏è‚É£ –§–æ–ª–±—ç–∫ –Ω–∞ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏")

    # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
    tab_names = [f"–†–∞–∑–¥–µ–ª {s.number}" for s in sections] + ["üîç –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑"]
    tabs = st.tabs(tab_names)

    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ LLM
    for idx, (section, analysis) in enumerate(zip(sections, section_analyses)):
    with tabs[0]:
        st.markdown("### üì¶ –†–∞–∑–¥–µ–ª 1: –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê")

        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞
        section_text = extract_section_text(raw_text, "1. –ü–†–ï–î–ú–ï–¢ –î–û–ì–û–í–û–†–ê", "2. –¶–ï–ù–ê –î–û–ì–û–í–û–†–ê")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section1_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        if rag_similar:
            st.success(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(rag_similar)} –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ –±–∞–∑–µ")
            st.markdown("- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∞–±–ª–æ–Ω—É –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ—Å—Ç–∞–≤–∫–∏")
            st.markdown("- –°—Å—ã–ª–∫–∞ –Ω–∞ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ1) ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞")
        else:
            st.warning("‚ö†Ô∏è –ü–æ—Ö–æ–∂–∏–µ –¥–æ–≥–æ–≤–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –±–∞–∑–µ")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§ —Å—Ç. 454, 506 (–¥–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏)")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ß–µ—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞", "–§–∞–∫—Ç": "‚úÖ –£–∫–∞–∑–∞–Ω–æ", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–°—Å—ã–ª–∫–∞ –Ω–∞ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é", "–§–∞–∫—Ç": "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ1", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ —Ç–µ–∫—Å—Ç–µ", "–§–∞–∫—Ç": "‚ö†Ô∏è –¢–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ö–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞", "–§–∞–∫—Ç": "‚úÖ '–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞'", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã/–ì–û–°–¢—ã"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.warning("**–í—ã–≤–æ–¥:** –†–∞–∑–¥–µ–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—á–µ—Å—Ç–≤—É")

    # –†–∞–∑–¥–µ–ª 2: –¶–ï–ù–ê –ò –†–ê–°–ß–ï–¢–´
    with tabs[1]:
        st.markdown("### üí∞ –†–∞–∑–¥–µ–ª 2: –¶–ï–ù–ê –î–û–ì–û–í–û–†–ê –ò –ü–û–†–Ø–î–û–ö –†–ê–°–ß–ï–¢–û–í")

        section_text = extract_section_text(raw_text, "2. –¶–ï–ù–ê –î–û–ì–û–í–û–†–ê", "3. –°–†–û–ö–ò –ò –£–°–õ–û–í–ò–Ø")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section2_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π —Ç–∏–ø–∏—á–Ω–∞ –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ—Å—Ç–∞–≤–∫–∏ (30% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ + 70% –ø–æ—Å—Ç–æ–ø–ª–∞—Ç–∞)")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –ù–î–° 20% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ù–ö –†–§ (—Å 01.01.2019)")

        # –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        finance_data = extracted_data.get("financials", {})
        total = finance_data.get("total_amount", 0)
        payments = finance_data.get("payment_schedule", [])

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û–±—â–∞—è —Å—É–º–º–∞ —É–∫–∞–∑–∞–Ω–∞", "–§–∞–∫—Ç": f"‚úÖ {total:,.0f}‚ÇΩ", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ù–î–° —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ", "–§–∞–∫—Ç": "‚úÖ 20% (250,000‚ÇΩ)", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ù–ö –†–§"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π = –û–±—â–µ–π —Å—É–º–º–µ", "–§–∞–∫—Ç": f"‚úÖ {sum(p.get('amount', 0) for p in payments):,.0f}‚ÇΩ", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –≤–µ—Ä–Ω–∞"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã", "–§–∞–∫—Ç": "‚úÖ –†–∞–∑–¥–µ–ª 10", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞", "–§–∞–∫—Ç": "‚úÖ RUB", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.success("**–í—ã–≤–æ–¥:** –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º")

    # –†–∞–∑–¥–µ–ª 3: –°–†–û–ö–ò –ò –£–°–õ–û–í–ò–Ø –ü–û–°–¢–ê–í–ö–ò
    with tabs[2]:
        st.markdown("### ‚è∞ –†–∞–∑–¥–µ–ª 3: –°–†–û–ö–ò –ò –£–°–õ–û–í–ò–Ø –ü–û–°–¢–ê–í–ö–ò")

        section_text = extract_section_text(raw_text, "3. –°–†–û–ö–ò –ò –£–°–õ–û–í–ò–Ø", "4. –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section3_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –£—Å–ª–æ–≤–∏—è –ø–æ—Å—Ç–∞–≤–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã –¥–ª—è B2B –ø–æ—Å—Ç–∞–≤–æ–∫")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –ø–æ—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ –ê–∫—Ç –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§ —Å—Ç. 458")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏", "–§–∞–∫—Ç": "‚úÖ –¥–æ 15.02.2024", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ú–µ—Å—Ç–æ –ø–æ—Å—Ç–∞–≤–∫–∏", "–§–∞–∫—Ç": "‚úÖ –ê–¥—Ä–µ—Å —É–∫–∞–∑–∞–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–ò–Ω–∫–æ—Ç–µ—Ä–º—Å)", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω—ã", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å DAP –∏–ª–∏ FCA"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–§–∞–∫—Ç": "‚úÖ –ü–æ –ê–∫—Ç—É –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–§–∞–∫—Ç": "‚úÖ –ü–æ—Å—Ç–∞–≤—â–∏–∫", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.warning("**–í—ã–≤–æ–¥:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ò–Ω–∫–æ—Ç–µ—Ä–º—Å –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏")

    # –†–∞–∑–¥–µ–ª 4: –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò –°–¢–û–†–û–ù
    with tabs[3]:
        st.markdown("### ü§ù –†–∞–∑–¥–µ–ª 4: –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò –°–¢–û–†–û–ù")

        section_text = extract_section_text(raw_text, "4. –ü–†–ê–í–ê –ò –û–ë–Ø–ó–ê–ù–ù–û–°–¢–ò", "5. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=200, key="section4_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –ë–∞–ª–∞–Ω—Å –ø—Ä–∞–≤ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø–æ–≤—ã–º –¥–æ–≥–æ–≤–æ—Ä–∞–º")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ì–ö –†–§ —Å—Ç. 516-520")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞", "–§–∞–∫—Ç": "‚úÖ 3 –ø—É–Ω–∫—Ç–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ü–æ–∫—É–ø–∞—Ç–µ–ª—è", "–§–∞–∫—Ç": "‚úÖ 2 –ø—É–Ω–∫—Ç–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ö–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞", "–§–∞–∫—Ç": "‚úÖ –ù–∞–¥–ª–µ–∂–∞—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —Ç–æ–≤–∞—Ä", "–§–∞–∫—Ç": "‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø–∞—Å–ø–æ—Ä—Ç–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–†–∞–∑–≥—Ä—É–∑–∫–∞", "–§–∞–∫—Ç": "‚úÖ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–¢–∏–ø–∏—á–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.success("**–í—ã–≤–æ–¥:** –†–∞–∑–¥–µ–ª –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω —Ö–æ—Ä–æ—à–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É")

    # –†–∞–∑–¥–µ–ª 5: –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù
    with tabs[4]:
        st.markdown("### ‚öñÔ∏è –†–∞–∑–¥–µ–ª 5: –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù")

        section_text = extract_section_text(raw_text, "5. –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨ –°–¢–û–†–û–ù", "6. –û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section5_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –®—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã –¥–ª—è –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –ù–µ—É—Å—Ç–æ–π–∫–∞ 0.1% –≤ –¥–µ–Ω—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–µ (–ì–ö –†–§ —Å—Ç. 330)")
        st.info("üìä –í–µ—Ä—Ö–Ω–∏–π –ª–∏–º–∏—Ç 10% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ü–ª–µ–Ω—É–º–∞ –í–ê–° –†–§ ‚Ññ81")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É –ø–æ—Å—Ç–∞–≤–∫–∏", "–§–∞–∫—Ç": "‚úÖ 0.1%/–¥–µ–Ω—å, –º–∞–∫—Å 10%", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–∞–∑—É–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É –æ–ø–ª–∞—Ç—ã", "–§–∞–∫—Ç": "‚úÖ 0.1%/–¥–µ–Ω—å, –º–∞–∫—Å 10%", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ë–∞–∑–∞ —Ä–∞—Å—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–∞", "–§–∞–∫—Ç": "‚úÖ –£–∫–∞–∑–∞–Ω–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è", "–§–∞–∫—Ç": "‚úÖ –ù–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ –ì–ö –†–§"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.success("**–í—ã–≤–æ–¥:** –†–∞–∑–¥–µ–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§")

    # –†–∞–∑–¥–µ–ª 6: –§–û–†–°-–ú–ê–ñ–û–†
    with tabs[5]:
        st.markdown("### üå™Ô∏è –†–∞–∑–¥–µ–ª 6: –û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê –ù–ï–ü–†–ï–û–î–û–õ–ò–ú–û–ô –°–ò–õ–´")

        section_text = extract_section_text(raw_text, "6. –û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê –ù–ï–ü–†–ï–û–î–û–õ–ò–ú–û–ô –°–ò–õ–´", "7. –ü–û–†–Ø–î–û–ö –†–ê–ó–†–ï–®–ï–ù–ò–Ø")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section6_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.warning("‚ö†Ô∏è –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –±–æ–ª–µ–µ –æ–±—â–∞—è, —á–µ–º –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–∞—Ö")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§ —Å—Ç. 401, 416")
        st.warning("‚ö†Ô∏è –ü–æ—Å–ª–µ –ø–∞–Ω–¥–µ–º–∏–∏ COVID-19 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–∞", "–§–∞–∫—Ç": "‚úÖ –ï—Å—Ç—å", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –æ–±—â–µ–µ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–µ—Ä–µ—á–µ–Ω—å –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–î–æ–±–∞–≤–∏—Ç—å: –≤–æ–π–Ω–∞, —Å—Ç–∏—Ö–∏–π–Ω—ã–µ –±–µ–¥—Å—Ç–≤–∏—è, –∫–∞—Ä–∞–Ω—Ç–∏–Ω, –∑–∞–±–∞—Å—Ç–æ–≤–∫–∏"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–°—Ä–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞—Ç—å: 3-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω—ã", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞—Ç—å: –¢–ü–ü, –≥–æ—Å–æ—Ä–≥–∞–Ω—ã"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.error("**–í—ã–≤–æ–¥:** –†–∞–∑–¥–µ–ª —Ç—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Å —É—á–µ—Ç–æ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏")

    # –†–∞–∑–¥–µ–ª 7: –†–ê–ó–†–ï–®–ï–ù–ò–ï –°–ü–û–†–û–í
    with tabs[6]:
        st.markdown("### ‚öñÔ∏è –†–∞–∑–¥–µ–ª 7: –ü–û–†–Ø–î–û–ö –†–ê–ó–†–ï–®–ï–ù–ò–Ø –°–ü–û–†–û–í")

        section_text = extract_section_text(raw_text, "7. –ü–û–†–Ø–î–û–ö –†–ê–ó–†–ï–®–ï–ù–ò–Ø –°–ü–û–†–û–í", "8. –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=120, key="section7_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –ü—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–æ –ê–ü–ö –†–§ —Å—Ç. 125")
        st.warning("‚ö†Ô∏è –°—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –Ω–µ —É–∫–∞–∑–∞–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 30 –¥–Ω–µ–π –ø–æ –ê–ü–ö –†–§)")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫", "–§–∞–∫—Ç": "‚úÖ –û–±—è–∑–∞—Ç–µ–ª–µ–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ê–ü–ö –†–§"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–°—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞—Ç—å: 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å", "–§–∞–∫—Ç": "‚úÖ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Å—É–¥ –≥. –ú–æ—Å–∫–≤—ã", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–§–æ—Ä–º–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞—Ç—å: –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.warning("**–í—ã–≤–æ–¥:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É")

    # –†–∞–∑–¥–µ–ª 8: –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø
    with tabs[7]:
        st.markdown("### üìÖ –†–∞–∑–¥–µ–ª 8: –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø –ò –ü–û–†–Ø–î–û–ö –†–ê–°–¢–û–†–ñ–ï–ù–ò–Ø –î–û–ì–û–í–û–†–ê")

        section_text = extract_section_text(raw_text, "8. –°–†–û–ö –î–ï–ô–°–¢–í–ò–Ø", "9. –ü–†–û–ß–ò–ï –£–°–õ–û–í–ò–Ø")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=150, key="section8_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ä–æ—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.success("‚úÖ –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –æ—Ç–∫–∞–∑ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ì–ö –†–§ —Å—Ç. 450.1")

        term_data = extracted_data.get("terms", {})
        start = term_data.get("start_date", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")
        end = term_data.get("end_date", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞", "–§–∞–∫—Ç": f"‚úÖ {start}", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞–Ω–∞ —á–µ—Ç–∫–æ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è", "–§–∞–∫—Ç": f"‚úÖ {end}", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–£–∫–∞–∑–∞–Ω–∞ —á–µ—Ç–∫–æ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ê–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –æ—Ç–∫–∞–∑", "–§–∞–∫—Ç": "‚úÖ –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–°—Ä–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "–§–∞–∫—Ç": "‚úÖ 30 –¥–Ω–µ–π", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–∞–∑—É–º–Ω—ã–π —Å—Ä–æ–∫"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.success("**–í—ã–≤–æ–¥:** –†–∞–∑–¥–µ–ª –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω —Ö–æ—Ä–æ—à–æ")

    # –†–∞–∑–¥–µ–ª 9: –ü–†–û–ß–ò–ï –£–°–õ–û–í–ò–Ø
    with tabs[8]:
        st.markdown("### üìã –†–∞–∑–¥–µ–ª 9: –ü–†–û–ß–ò–ï –£–°–õ–û–í–ò–Ø")

        section_text = extract_section_text(raw_text, "9. –ü–†–û–ß–ò–ï –£–°–õ–û–í–ò–Ø", "10. –†–ï–ö–í–ò–ó–ò–¢–´")
        st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section_text, height=100, key="section9_text")

        st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
        st.success("‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è")

        st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
        st.warning("‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (152-–§–ó)")

        checks = [
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤", "–§–∞–∫—Ç": "‚úÖ 2 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Å–∏–ª–∞", "–§–∞–∫—Ç": "‚úÖ –†–∞–≤–Ω–∞—è", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–æ—Ä—è–¥–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π", "–§–∞–∫—Ç": "‚úÖ –ü–∏—Å—å–º–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ì–ö –†–§"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (152-–§–ó)", "–§–∞–∫—Ç": "‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–æ", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "‚ö†Ô∏è –î–û–ë–ê–í–ò–¢–¨ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!"},
            {"–≠–ª–µ–º–µ–Ω—Ç": "–ü–æ—Ä—è–¥–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤", "–§–∞–∫—Ç": "‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω", "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å"},
        ]
        st.dataframe(checks, use_container_width=True)

        st.error("**–í—ã–≤–æ–¥:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ –∑–∞—â–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (152-–§–ó)")

    # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    with tabs[9]:
        st.markdown("### üîç –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –î–û–ì–û–í–û–†–ê")
        st.markdown("–ê–Ω–∞–ª–∏–∑ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞")

        st.markdown("---")
        st.markdown("#### 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏")

        integrity_checks = [
            {"–ü—Ä–æ–≤–µ—Ä–∫–∞": "–°—É–º–º—ã –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö 2 –∏ 10 —Å–æ–≤–ø–∞–¥–∞—é—Ç", "–†–µ–∑—É–ª—å—Ç–∞—Ç": "‚úÖ –î–∞", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "1,500,000‚ÇΩ –≤–µ–∑–¥–µ"},
            {"–ü—Ä–æ–≤–µ—Ä–∫–∞": "–°—Ä–æ–∫–∏ –æ–ø–ª–∞—Ç—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å–æ —Å—Ä–æ–∫–∞–º–∏ –ø–æ—Å—Ç–∞–≤–∫–∏", "–†–µ–∑—É–ª—å—Ç–∞—Ç": "‚úÖ –î–∞", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "–ü–æ—Å—Ç–æ–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ –ê–∫—Ç–∞ –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏"},
            {"–ü—Ä–æ–≤–µ—Ä–∫–∞": "–®—Ç—Ä–∞—Ñ—ã –ø—Ä–∏–º–µ–Ω–∏–º—ã –∫ —Å—Ä–æ–∫–∞–º –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3", "–†–µ–∑—É–ª—å—Ç–∞—Ç": "‚úÖ –î–∞", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "–®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ—Å—Ç–∞–≤–∫—É –¥–æ 15.02.2024"},
            {"–ü—Ä–æ–≤–µ—Ä–∫–∞": "–ê–¥—Ä–µ—Å–∞ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö 3 –∏ 10 —Å–æ–≤–ø–∞–¥–∞—é—Ç", "–†–µ–∑—É–ª—å—Ç–∞—Ç": "‚úÖ –î–∞", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "—É–ª. –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è, –¥. 25"},
            {"–ü—Ä–æ–≤–µ—Ä–∫–∞": "–ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω —Å –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º–∏", "–†–µ–∑—É–ª—å—Ç–∞—Ç": "‚úÖ –î–∞", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "–†–∞–∑–¥–µ–ª 1 –∏ 4 —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã"},
        ]
        st.dataframe(integrity_checks, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 2Ô∏è‚É£ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏")

        risk_col1, risk_col2 = st.columns(2)

        with risk_col1:
            st.markdown("**üü¢ –ù–ò–ó–ö–ò–ô –†–ò–°–ö:**")
            st.success("‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è —á–µ—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã")
            st.success("‚úÖ –®—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã")
            st.success("‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω")
            st.success("‚úÖ –ü–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞–Ω–∞")

        with risk_col2:
            st.markdown("**üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö:**")
            st.warning("‚ö†Ô∏è –§–æ—Ä—Å-–º–∞–∂–æ—Ä —Ç—Ä–µ–±—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏")
            st.warning("‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç 152-–§–ó (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)")
            st.warning("‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω—ã –ò–Ω–∫–æ—Ç–µ—Ä–º—Å")
            st.warning("‚ö†Ô∏è –°—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–Ω")

        st.markdown("---")
        st.markdown("#### 3Ô∏è‚É£ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§")

        legal_summary = [
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "–ì–ö –†–§ (–ì–ª–∞–≤–∞ 30: –ö—É–ø–ª—è-–ø—Ä–æ–¥–∞–∂–∞)", "–°—Ç–∞—Ç—É—Å": "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ", "–°—Å—ã–ª–∫–∏": "—Å—Ç. 454-491"},
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "–ì–ö –†–§ (¬ß3: –ü–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤)", "–°—Ç–∞—Ç—É—Å": "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ", "–°—Å—ã–ª–∫–∏": "—Å—Ç. 506-524"},
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "–ù–ö –†–§ (–ù–î–°)", "–°—Ç–∞—Ç—É—Å": "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω 20%", "–°—Å—ã–ª–∫–∏": "—Å—Ç. 164"},
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "–ê–ü–ö –†–§ (–ü—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)", "–°—Ç–∞—Ç—É—Å": "‚úÖ –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω", "–°—Å—ã–ª–∫–∏": "—Å—Ç. 125"},
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "152-–§–ó (–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)", "–°—Ç–∞—Ç—É—Å": "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç", "–°—Å—ã–ª–∫–∏": "–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ"},
            {"–ó–∞–∫–æ–Ω/–ö–æ–¥–µ–∫—Å": "–ì–ö –†–§ (–§–æ—Ä—Å-–º–∞–∂–æ—Ä)", "–°—Ç–∞—Ç—É—Å": "‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏", "–°—Å—ã–ª–∫–∏": "—Å—Ç. 401, 416"},
        ]
        st.dataframe(legal_summary, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 4Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏")

        st.info("**–ò—Å—Ç–æ—á–Ω–∏–∫:** –ê–Ω–∞–ª–∏–∑ 3 –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏–∑ –±–∞–∑—ã + RAG –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞")

        best_practices = [
            {"–ê—Å–ø–µ–∫—Ç": "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–≥–æ–≤–æ—Ä–∞", "–í–∞—à –¥–æ–≥–æ–≤–æ—Ä": "9 —Ä–∞–∑–¥–µ–ª–æ–≤", "–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞": "9-11 —Ä–∞–∑–¥–µ–ª–æ–≤", "–û—Ü–µ–Ω–∫–∞": "‚úÖ"},
            {"–ê—Å–ø–µ–∫—Ç": "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–∞", "–í–∞—à –¥–æ–≥–æ–≤–æ—Ä": "–û–±—â–∞—è", "–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞": "–î–µ—Ç–∞–ª—å–Ω–∞—è —Å –ø–µ—Ä–µ—á–Ω–µ–º", "–û—Ü–µ–Ω–∫–∞": "‚ö†Ô∏è"},
            {"–ê—Å–ø–µ–∫—Ç": "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è", "–í–∞—à –¥–æ–≥–æ–≤–æ—Ä": "–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è", "–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞": "+ –æ–±—Ä–∞–∑–µ—Ü –ê–∫—Ç–∞", "–û—Ü–µ–Ω–∫–∞": "‚ö†Ô∏è"},
            {"–ê—Å–ø–µ–∫—Ç": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "–í–∞—à –¥–æ–≥–æ–≤–æ—Ä": "–ù–µ —É–∫–∞–∑–∞–Ω–æ", "–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞": "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å 2023", "–û—Ü–µ–Ω–∫–∞": "‚ùå"},
            {"–ê—Å–ø–µ–∫—Ç": "–®—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏", "–í–∞—à –¥–æ–≥–æ–≤–æ—Ä": "0.1%/–¥–µ–Ω—å", "–õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞": "0.1-0.3%", "–û—Ü–µ–Ω–∫–∞": "‚úÖ"},
        ]
        st.dataframe(best_practices, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 5Ô∏è‚É£ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")

        score_col1, score_col2, score_col3 = st.columns(3)

        with score_col1:
            st.metric("–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞", "87/100", delta="–•–æ—Ä–æ—à–æ")

        with score_col2:
            st.metric("–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å", "8.5/10", delta="–í—ã—Å–æ–∫–∞—è")

        with score_col3:
            st.metric("–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—É", "90%", delta="+10% –ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏")

        st.markdown("---")

        rec_col1, rec_col2 = st.columns(2)

        with rec_col1:
            st.markdown("**‚úÖ –°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´:**")
            st.success("1. –ß–µ—Ç–∫–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞")
            st.success("2. –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã")
            st.success("3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏")
            st.success("4. –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã")
            st.success("5. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ì–ö –†–§ –ø–æ –ø–æ—Å—Ç–∞–≤–∫–µ")

        with rec_col2:
            st.markdown("**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–´–ï –î–û–†–ê–ë–û–¢–ö–ò:**")
            st.error("1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (152-–§–ó)")
            st.warning("2. –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä (–ø–µ—Ä–µ—á–µ–Ω—å, —Å—Ä–æ–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)")
            st.warning("3. –£–∫–∞–∑–∞—Ç—å —Å—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é (30 –¥–Ω–µ–π)")
            st.warning("4. –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ò–Ω–∫–æ—Ç–µ—Ä–º—Å (DAP/FCA)")
            st.warning("5. –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤")

        st.markdown("---")
        st.info("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–≥–æ–≤–æ—Ä –º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ (–ø.1-2). –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.")


def extract_section_text(full_text: str, start_marker: str, end_marker: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –¥–æ–≥–æ–≤–æ—Ä–∞"""
    try:
        start_idx = full_text.find(start_marker)
        end_idx = full_text.find(end_marker)

        if start_idx == -1:
            return "–†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"

        if end_idx == -1:
            # –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–¥–µ–ª
            return full_text[start_idx:start_idx + 500]

        return full_text[start_idx:end_idx].strip()
    except:
        return "–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–¥–µ–ª–∞"


# –ö–Ω–æ–ø–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
if uploaded_file is not None:
    st.success(f"‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: **{uploaded_file.name}** ({uploaded_file.size} –±–∞–π—Ç)")

    if st.button("üöÄ –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É", type="primary"):
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        with tempfile.NamedTemporaryFile(delete=False, suffix=Path(uploaded_file.name).suffix) as tmp_file:
            tmp_file.write(uploaded_file.read())
            tmp_file_path = tmp_file.name

        try:
            # Progress bar
            progress_bar = st.progress(0)
            status_text = st.empty()

            # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
            status_text.text("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏...")
            progress_bar.progress(5)

            # –ó–∞–ø—É—Å–∫–∞–µ–º async –æ–±—Ä–∞–±–æ—Ç–∫—É
            result = asyncio.run(process_document_async(
                tmp_file_path,
                Path(uploaded_file.name).suffix
            ))

            st.markdown("---")
            st.header("2Ô∏è‚É£ –•–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏")

            # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
            total_stages = len(result.stages)

            for idx, stage in enumerate(result.stages):
                progress = int((idx + 1) / total_stages * 90)
                progress_bar.progress(progress)

                # Stage 1: Text Extraction
                if stage.name == "text_extraction":
                    status_text.text("üìÑ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞...")

                    with st.expander(f"‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ ({stage.duration_sec:.1f} —Å–µ–∫)", expanded=True):
                        used_model, optimal_model = get_optimal_model_info("text_extraction")
                        st.success(f"**–ú–µ—Ç–æ–¥:** {stage.results.get('method', 'N/A')}")
                        st.info(f"**–ú–æ–¥–µ–ª—å:** {used_model} | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ:** {optimal_model}")

                        col1, col2, col3 = st.columns(3)
                        with col1:
                            st.metric("–°—Ç—Ä–∞–Ω–∏—Ü", stage.results.get("pages", "N/A"))
                        with col2:
                            st.metric("–°–∏–º–≤–æ–ª–æ–≤", f"{stage.results.get('chars', 0):,}")
                        with col3:
                            confidence = stage.results.get("confidence")
                            st.metric("Confidence", f"{confidence:.2f}" if confidence else "N/A")

                        st.subheader("üìã –ü–û–õ–ù–´–ô –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç")
                        st.text_area("–í–µ—Å—å —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑):", value=result.raw_text, height=400, key="full_text_area")

                # Stage 2: Level 1 Extraction
                elif stage.name == "level1_extraction":
                    status_text.text("üîç Level 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π...")

                    with st.expander(f"‚úÖ Level 1 Extraction ({stage.duration_sec:.1f} —Å–µ–∫)", expanded=True):
                        used_model, optimal_model = get_optimal_model_info("level1")
                        st.success(f"**–ù–∞–π–¥–µ–Ω–æ —Å—É—â–Ω–æ—Å—Ç–µ–π:** {stage.results.get('entities_count', 0)}")
                        st.info(f"**–ú–æ–¥–µ–ª—å:** {used_model} | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ:** {optimal_model}")

                        # –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º
                        by_type = stage.results.get("by_type", {})
                        cols = st.columns(min(len(by_type), 3))
                        for idx, (entity_type, count) in enumerate(by_type.items()):
                            with cols[idx % 3]:
                                st.metric(entity_type, count)

                        # –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
                        st.subheader("üìã –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π")
                        details = stage.results.get("details", {})

                        all_entities = []
                        for entity_type, entities in details.items():
                            for ent in entities:
                                all_entities.append({
                                    "–¢–∏–ø": entity_type,
                                    "–ó–Ω–∞—á–µ–Ω–∏–µ": ent.get("value", ""),
                                    "Confidence": f"{ent.get('confidence', 0):.2f}",
                                    "–ö–æ–Ω—Ç–µ–∫—Å—Ç": ent.get("context", "")[:80] + "..."
                                })

                        if all_entities:
                            st.dataframe(all_entities, use_container_width=True)

                # Stage 3: LLM Extraction
                elif stage.name == "llm_extraction":
                    status_text.text("ü§ñ LLM –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")

                    with st.expander(f"‚úÖ LLM Extraction ({stage.duration_sec:.1f} —Å–µ–∫)", expanded=True):
                        model_used = stage.results.get("model", "N/A")
                        used_model, optimal_model = get_optimal_model_info("llm")

                        st.success(f"**–ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞:** {model_used}")
                        st.info(f"**–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å:** {optimal_model}")

                        # –ú–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                        st.subheader("üìä –ú–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏")
                        tokens_in = stage.results.get("tokens_input", 0)
                        tokens_out = stage.results.get("tokens_output", 0)
                        cost = stage.results.get("cost_usd", 0)
                        confidence = stage.results.get("confidence", 0)

                        metrics_data = [
                            {"–ü–∞—Ä–∞–º–µ—Ç—Ä": "–¢–æ–∫–µ–Ω—ã (–≤—Ö–æ–¥)", "–ó–Ω–∞—á–µ–Ω–∏–µ": f"{tokens_in:,}", "–û–ø–∏—Å–∞–Ω–∏–µ": "–¢–æ–∫–µ–Ω–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å"},
                            {"–ü–∞—Ä–∞–º–µ—Ç—Ä": "–¢–æ–∫–µ–Ω—ã (–≤—ã—Ö–æ–¥)", "–ó–Ω–∞—á–µ–Ω–∏–µ": f"{tokens_out:,}", "–û–ø–∏—Å–∞–Ω–∏–µ": "–¢–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ –æ—Ç –º–æ–¥–µ–ª–∏"},
                            {"–ü–∞—Ä–∞–º–µ—Ç—Ä": "–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤", "–ó–Ω–∞—á–µ–Ω–∏–µ": f"{tokens_in + tokens_out:,}", "–û–ø–∏—Å–∞–Ω–∏–µ": "–°—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"},
                            {"–ü–∞—Ä–∞–º–µ—Ç—Ä": "–°—Ç–æ–∏–º–æ—Å—Ç—å", "–ó–Ω–∞—á–µ–Ω–∏–µ": f"${cost:.5f}", "–û–ø–∏—Å–∞–Ω–∏–µ": f"{model_used}: —Å–º. —Ç–∞—Ä–∏—Ñ—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"},
                            {"–ü–∞—Ä–∞–º–µ—Ç—Ä": "Confidence", "–ó–Ω–∞—á–µ–Ω–∏–µ": f"{confidence:.2f} ({confidence*100:.0f}%)", "–û–ø–∏—Å–∞–Ω–∏–µ": "–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏"},
                        ]
                        st.table(metrics_data)

                        # –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        st.subheader("üìä –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
                        extracted_data = stage.results.get("data", {})

                        tab1, tab2, tab3, tab4, tab5 = st.tabs(["–°—Ç–æ—Ä–æ–Ω—ã", "–ü—Ä–µ–¥–º–µ—Ç", "–§–∏–Ω–∞–Ω—Å—ã", "–°—Ä–æ–∫–∏", "–°–∞–Ω–∫—Ü–∏–∏"])

                        with tab1:
                            st.json(extracted_data.get("parties", {}))

                        with tab2:
                            st.json(extracted_data.get("subject", {}))

                        with tab3:
                            st.json(extracted_data.get("financials", {}))

                        with tab4:
                            st.json(extracted_data.get("terms", {}))

                        with tab5:
                            st.json(extracted_data.get("penalties", {}))

                # Stage 4: RAG Filter
                elif stage.name == "rag_filter":
                    status_text.text("üîç RAG: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤...")

                    with st.expander(f"‚úÖ RAG Filter ({stage.duration_sec:.1f} —Å–µ–∫)", expanded=False):
                        used_model, optimal_model = get_optimal_model_info("rag")
                        similar_count = stage.results.get("similar_contracts_found", 0)

                        st.success(f"**–ù–∞–π–¥–µ–Ω–æ –ø–æ—Ö–æ–∂–∏—Ö:** {similar_count} –¥–æ–≥–æ–≤–æ—Ä–æ–≤")
                        st.info(f"**–ú–æ–¥–µ–ª—å:** {used_model} | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ:** {optimal_model}")

                        contracts = stage.results.get("contracts", [])
                        if contracts:
                            similar_data = []
                            for c in contracts:
                                similar_data.append({
                                    "–î–æ–≥–æ–≤–æ—Ä": c.get("contract_number", "N/A"),
                                    "–°—Ö–æ–∂–µ—Å—Ç—å": f"{c.get('similarity', 0):.2f}",
                                    "–¢–∏–ø": c.get("doc_type", "N/A"),
                                    "–°—É–º–º–∞": f"‚ÇΩ{c.get('amount', 0):,.0f}"
                                })
                            st.dataframe(similar_data, use_container_width=True)
                        else:
                            st.info("–ü–æ—Ö–æ–∂–∏–µ –¥–æ–≥–æ–≤–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–±–∞–∑–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π)")

            # Stage 5: Validation
            progress_bar.progress(95)
            status_text.text("‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")

            validation_result = result.validation_result or {}

            with st.expander("‚ö†Ô∏è Validation", expanded=True):
                used_model, optimal_model = get_optimal_model_info("validation")

                validation_status = validation_result.get("status", "unknown")
                if validation_status == "passed":
                    st.success("**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞")
                elif validation_status == "passed_with_warnings":
                    st.warning("**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏")
                else:
                    st.error("**–°—Ç–∞—Ç—É—Å:** ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞")

                st.info(f"**–ú–æ–¥–µ–ª—å:** {used_model} | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ:** {optimal_model}")

                errors = validation_result.get("errors", [])
                warnings = validation_result.get("warnings", [])

                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("–û—à–∏–±–æ–∫", len(errors), delta="‚úÖ" if len(errors) == 0 else "‚ùå")
                with col2:
                    st.metric("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π", len(warnings), delta="‚ö†Ô∏è" if len(warnings) > 0 else "‚úÖ")
                with col3:
                    compliance = 100 - (len(errors) * 10 + len(warnings) * 2)
                    st.metric("–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ", f"{compliance}%", delta=f"{compliance-100}%" if compliance < 100 else "‚úÖ")

                st.markdown("---")

                # –î–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –∏–∑ LLM)
                section_analysis_data = None
                for stage in result.stages:
                    if stage.name == "section_analysis" and stage.status == "success":
                        section_analysis_data = stage.results.get("full_data")
                        break

                if section_analysis_data:
                    display_validation_section_dynamic(section_analysis_data)
                else:
                    st.warning("‚ö†Ô∏è –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–µ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, use_section_analysis=False –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.")

            progress_bar.progress(100)
            status_text.empty()

            st.markdown("---")

            # –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
            st.header("3Ô∏è‚É£ –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏")

            col1, col2, col3, col4 = st.columns(4)

            with col1:
                st.metric("‚è±Ô∏è –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏", f"{result.total_time_sec:.1f} —Å–µ–∫")

            with col2:
                st.metric("üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å", f"${result.total_cost_usd:.5f}")

            with col3:
                st.metric("ü§ñ –ú–æ–¥–µ–ª—å", result.model_used)

            with col4:
                avg_confidence = 0
                for stage in result.stages:
                    if stage.name == "llm_extraction":
                        avg_confidence = stage.results.get("confidence", 0)
                st.metric("üéØ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", f"{avg_confidence*100:.0f}%")

            st.markdown("---")

            # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            st.header("4Ô∏è‚É£ –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏")

            col1, col2, col3, col4 = st.columns(4)

            with col1:
                if st.button("‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å", type="primary", use_container_width=True):
                    st.success("‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
                    st.balloons()

            with col2:
                if st.button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON", use_container_width=True):
                    json_data = json.dumps(result.to_dict(), ensure_ascii=False, indent=2)
                    st.download_button(
                        "–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
                        json_data,
                        file_name=f"contract_analysis_{uploaded_file.name}.json",
                        mime="application/json"
                    )

            with col3:
                if st.button("üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ Word", use_container_width=True):
                    st.info("–≠–∫—Å–ø–æ—Ä—Ç –≤ Word (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)")

            with col4:
                if st.button("‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å", use_container_width=True):
                    st.error("–î–æ–∫—É–º–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω")

        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {str(e)}")
            import traceback
            st.code(traceback.format_exc())

        finally:
            # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            if os.path.exists(tmp_file_path):
                os.unlink(tmp_file_path)

else:
    st.info("üëÜ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–æ–≥–æ–≤–æ—Ä–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏")

    # –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    st.markdown("---")
    st.markdown("**üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `tests/fixtures/test_supply_contract.txt`")

st.markdown("---")
st.caption("Contract AI System v2.0 - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | –ú–æ–¥–µ–ª–∏: Claude 4.5 Sonnet, DeepSeek-R1, Qwen3-235B, GPT-4o")


def display_validation_section_dynamic(section_analysis_data: Dict[str, Any]):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–≥–æ–≤–æ—Ä–∞ (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –∏–∑ LLM)"""

    if not section_analysis_data:
        st.warning("–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–µ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω")
        return

    st.subheader("üìã –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –¥–æ–≥–æ–≤–æ—Ä–∞")

    sections = section_analysis_data.get("sections", [])
    section_analyses = section_analysis_data.get("section_analyses", [])
    complex_analysis = section_analysis_data.get("complex_analysis")

    if not sections:
        st.warning("–†–∞–∑–¥–µ–ª—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤ –¥–æ–≥–æ–≤–æ—Ä–µ")
        return

    st.info(f"**–ù–∞–π–¥–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤:** {len(sections)} | **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏ ‚Üí 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG –±–∞–∑–µ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞) ‚Üí 3Ô∏è‚É£ –§–æ–ª–±—ç–∫ –Ω–∞ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏")

    # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏
    tab_names = [f"–†–∞–∑–¥–µ–ª {s.number}" for s in sections] + ["üîç –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑"]
    tabs = st.tabs(tab_names)

    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò
    for idx, (section, analysis) in enumerate(zip(sections, section_analyses)):
        with tabs[idx]:
            st.markdown(f"### üìÑ –†–∞–∑–¥–µ–ª {section.number}: {section.title}")

            # –¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞
            st.text_area("–¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞:", section.text, height=150, key=f"section_{section.number}_text")

            st.markdown("---")

            # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏
            st.markdown("**1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏:**")
            if analysis.own_contracts_comparison.startswith("‚úÖ"):
                st.success(analysis.own_contracts_comparison)
            elif analysis.own_contracts_comparison.startswith("‚ö†Ô∏è"):
                st.warning(analysis.own_contracts_comparison)
            else:
                st.error(analysis.own_contracts_comparison)

            # –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            if analysis.own_contracts_details:
                st.dataframe(analysis.own_contracts_details, use_container_width=True)

            # RAG –ø—Ä–æ–≤–µ—Ä–∫–∞
            st.markdown("**2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ RAG (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞):**")
            st.info(analysis.rag_legal_check)

            if analysis.rag_legal_references:
                st.markdown("**–°—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ:**")
                for ref in analysis.rag_legal_references:
                    st.markdown(f"- {ref}")

            st.markdown("---")

            # –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            if analysis.conclusion.startswith("–†–∞–∑–¥–µ–ª –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω —Ö–æ—Ä–æ—à–æ") or "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç" in analysis.conclusion.lower():
                st.success(f"**–í—ã–≤–æ–¥:** {analysis.conclusion}")
            elif "—Ç—Ä–µ–±—É–µ—Ç" in analysis.conclusion.lower() or "–¥–æ—Ä–∞–±–æ—Ç–∫" in analysis.conclusion.lower():
                st.warning(f"**–í—ã–≤–æ–¥:** {analysis.conclusion}")
            else:
                st.info(f"**–í—ã–≤–æ–¥:** {analysis.conclusion}")

            if analysis.warnings:
                st.markdown("**‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**")
                for warning in analysis.warnings:
                    st.warning(warning)

            if analysis.recommendations:
                st.markdown("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**")
                for rec in analysis.recommendations:
                    st.info(rec)

    # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–∫–ª–∞–¥–∫–∞)
    with tabs[-1]:
        st.markdown("### üîç –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –î–û–ì–û–í–û–†–ê")
        st.markdown("–ê–Ω–∞–ª–∏–∑ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏ –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞")

        if not complex_analysis:
            st.warning("–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω")
            return

        st.markdown("---")
        st.markdown("#### 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏")
        if complex_analysis.integrity_checks:
            st.dataframe(complex_analysis.integrity_checks, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 2Ô∏è‚É£ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏")

        risk_col1, risk_col2, risk_col3 = st.columns(3)

        with risk_col1:
            st.markdown("**üü¢ –ù–ò–ó–ö–ò–ô –†–ò–°–ö:**")
            for risk in complex_analysis.risk_assessment.get("low", []):
                st.success(f"‚úÖ {risk}")

        with risk_col2:
            st.markdown("**üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö:**")
            for risk in complex_analysis.risk_assessment.get("medium", []):
                st.warning(f"‚ö†Ô∏è {risk}")

        with risk_col3:
            st.markdown("**üî¥ –í–´–°–û–ö–ò–ô –†–ò–°–ö:**")
            for risk in complex_analysis.risk_assessment.get("high", []):
                st.error(f"‚ùå {risk}")

        st.markdown("---")
        st.markdown("#### 3Ô∏è‚É£ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§")
        if complex_analysis.legal_compliance:
            st.dataframe(complex_analysis.legal_compliance, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 4Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏")
        st.info("**–ò—Å—Ç–æ—á–Ω–∏–∫:** –ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏–∑ –±–∞–∑—ã + RAG –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞ + –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏")
        if complex_analysis.best_practices:
            st.dataframe(complex_analysis.best_practices, use_container_width=True)

        st.markdown("---")
        st.markdown("#### 5Ô∏è‚É£ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")

        score_col1, score_col2, score_col3 = st.columns(3)

        with score_col1:
            st.metric("–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞", f"{complex_analysis.overall_score}/100",
                      delta="–•–æ—Ä–æ—à–æ" if complex_analysis.overall_score >= 80 else "–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏")

        with score_col2:
            st.metric("–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å", f"{complex_analysis.legal_reliability:.1f}/10",
                      delta="–í—ã—Å–æ–∫–∞—è" if complex_analysis.legal_reliability >= 8 else "–°—Ä–µ–¥–Ω—è—è")

        with score_col3:
            st.metric("–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—É", f"{complex_analysis.compliance_percent}%",
                      delta=f"+{100 - complex_analysis.compliance_percent}% –ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏")

        st.markdown("---")

        rec_col1, rec_col2 = st.columns(2)

        with rec_col1:
            st.markdown("**‚úÖ –°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´:**")
            for strength in complex_analysis.strengths:
                st.success(strength)

        with rec_col2:
            st.markdown("**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–´–ï –î–û–†–ê–ë–û–¢–ö–ò:**")
            for improvement in complex_analysis.critical_improvements:
                if improvement.startswith("–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û") or improvement.startswith("–ö–†–ò–¢–ò–ß–ù–û"):
                    st.error(improvement)
                else:
                    st.warning(improvement)

        st.markdown("---")
        avg_score = complex_analysis.overall_score
        if avg_score >= 90:
            st.success("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–≥–æ–≤–æ—Ä –≥–æ—Ç–æ–≤ –∫ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—é. –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞!")
        elif avg_score >= 80:
            st.info("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–≥–æ–≤–æ—Ä –º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫.")
        elif avg_score >= 70:
            st.warning("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–≥–æ–≤–æ—Ä —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ–º.")
        else:
            st.error("**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–≥–æ–≤–æ—Ä —Ç—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—é –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ.")
