# üìã –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ –£–õ–£–ß–®–ï–ù–ò–ô

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û (–ß–∞—Å—Ç–∏ 1-2)

### –ß–∞—Å—Ç—å 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (4 —Ä–æ–ª–∏)
- ‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- ‚úÖ –¢–∏–ø—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º (20 —Ç–∏–ø–æ–≤)

### –ß–∞—Å—Ç—å 2: UI –∏ —ç–∫—Å–ø–æ—Ä—Ç
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- ‚úÖ XML —ç–∫—Å–ø–æ—Ä—Ç

---

## ‚úÖ –°–¢–ê–¢–£–°: –í–°–ï –ì–û–¢–û–í–û!

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É. Streamlit –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8502

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:**
```python
# –í Streamlit UI:
Email: demo@example.com    # DEMO —Ä–æ–ª—å
Email: user@example.com    # FULL —Ä–æ–ª—å
Email: vip@example.com     # VIP —Ä–æ–ª—å
Email: admin@example.com   # ADMIN —Ä–æ–ª—å
```

**–í –∫–æ–¥–µ:**
```python
from src.utils.auth import (
    get_current_user,
    check_feature_access,
    show_upgrade_message
)

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = get_current_user()
print(user['name'], user['role'])

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–∏
if check_feature_access('can_export_pdf'):
    # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF
    pass
else:
    show_upgrade_message('–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF')
```

---

### 2. –¢–∏–ø—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

**–í UI:**
```python
from src.utils.contract_types import get_all_contract_names, get_contract_type_code

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –¥–ª—è selectbox
contract_names = get_all_contract_names()
selected = st.selectbox("–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞", contract_names)

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥
code = get_contract_type_code(selected)
# "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏" ‚Üí "supply"
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã:**
- –î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ (supply)
- –î–æ–≥–æ–≤–æ—Ä –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ (service)
- –î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã (lease)
- –î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ (purchase)
- –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (confidentiality)
- ... –∏ 15 –¥—Ä—É–≥–∏—Ö

---

### 3. –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.utils.knowledge_base import (
    initialize_knowledge_base,
    KnowledgeBaseCategory
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
kb = initialize_knowledge_base()

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = kb.get_category_statistics()
print(f"–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {stats['total']}")

# –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
docs = kb.list_documents(KnowledgeBaseCategory.LEGAL)

# –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
kb.add_document(
    KnowledgeBaseCategory.FORMS,
    "new_contract_template.txt",
    "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞..."
)
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
1. `KnowledgeBaseCategory.FORMS` - –§–æ—Ä–º—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤
2. `KnowledgeBaseCategory.LEGAL` - –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞
3. `KnowledgeBaseCategory.CASE_LAW` - –°—É–¥–µ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
4. `KnowledgeBaseCategory.KEY_CASES` - –ö–ª—é—á–µ–≤—ã–µ –∫–µ–π—Å—ã
5. `KnowledgeBaseCategory.TRENDS` - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏

---

### 4. XML –≠–∫—Å–ø–æ—Ä—Ç

**–≠–∫—Å–ø–æ—Ä—Ç –¥–æ–≥–æ–≤–æ—Ä–∞:**
```python
from src.services.xml_export import XMLExportService

contract_data = {
    'id': 'contract_123',
    'contract_type': 'supply',
    'party_1': {
        'name': '–û–û–û "–ö–æ–º–ø–∞–Ω–∏—è"',
        'inn': '1234567890',
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    },
    'party_2': {
        'name': '–û–û–û "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å"',
        'inn': '0987654321',
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    },
    'financial': {
        'amount': 1000000,
        'currency': 'RUB',
        'vat_included': True,
        'vat_rate': 20,
    },
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
}

# –≠–∫—Å–ø–æ—Ä—Ç
xml_service = XMLExportService()
xml_string = xml_service.export_contract_to_xml(contract_data)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
with open('contract.xml', 'w', encoding='utf-8') as f:
    f.write(xml_string)

# –í–∞–ª–∏–¥–∞—Ü–∏—è
is_valid = xml_service.validate_xml(xml_string)
```

---

### 5. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ app.py:**

```python
# –í app.py –¥–æ–±–∞–≤–∏—Ç—å:
from app_pages_improved import page_generator_improved, page_knowledge_base

# –í —Ñ—É–Ω–∫—Ü–∏–∏ main():
def main():
    # ...
    if current_page == 'generator':
        page_generator_improved()  # –í–º–µ—Å—Ç–æ page_generator()
    elif current_page == 'knowledge_base':
        page_knowledge_base()
    # ...
```

**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –¢–∏–ø—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ë–µ–∑ –ø–æ–ª—è user_id (–±–µ—Ä–µ—Ç—Å—è –∏–∑ —Å–µ—Å—Å–∏–∏)
- Template ID –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω (expander)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ—Ä–æ–Ω–∞—Ö:
  - –¢–∏–ø (–Æ–õ/–ò–ü/–§–∏–∑–ª–∏—Ü–æ)
  - –ü–æ–ª–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
  - –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
  - –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è:
  - –°—É–º–º–∞, –≤–∞–ª—é—Ç–∞
  - –ù–î–°
  - –£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã
  - –ê–≤–∞–Ω—Å
- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:
  - –ü–µ–Ω—è –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–µ—É—Å—Ç–æ–π–∫–∞
  - –õ–∏–º–∏—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
  - –§–æ—Ä—Å-–º–∞–∂–æ—Ä
- –£—Å–ª–æ–≤–∏—è –ø–æ—Å—Ç–∞–≤–∫–∏ (–¥–ª—è supply/purchase)
- –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ (—Å–ø–æ—Å–æ–±, –∫–æ–ª-–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

---

## üìù –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü–æ–ª–Ω—ã–π workflow –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞:

```python
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ—é —Ä–æ–ª—å –≤ sidebar

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤"
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
if not check_feature_access('can_generate_contracts'):
    show_upgrade_message('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤')
    return

# 3. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
contract_type_ru = "–î–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏"
contract_type = get_contract_type_code(contract_type_ru)  # ‚Üí "supply"

# 4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Å—Ç–æ—Ä–æ–Ω—ã —á–µ—Ä–µ–∑ expanders
party_1 = {
    'type': '–Æ–õ',
    'name': '–û–û–û "–ü–æ—Å—Ç–∞–≤—â–∏–∫"',
    'inn': '1234567890',
    'kpp': '123456789',
    'address': '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1',
    'bank': '–°–±–µ—Ä–±–∞–Ω–∫',
    'bik': '044525225',
    'account': '40702810000000000000',
    'director': '–ò–≤–∞–Ω–æ–≤ –ò.–ò.',
    'basis': '–£—Å—Ç–∞–≤–∞',
}

# 5. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —É—Å–ª–æ–≤–∏—è
financial = {
    'amount': 1000000,
    'currency': 'RUB',
    'vat_included': True,
    'vat_rate': 20,
    'payment_terms': 30,
    'prepayment': 30,
}

liability = {
    'penalty_rate': 0.1,
    'max_penalty': 10,
    'force_majeure': True,
}

# 6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–≥–æ–≤–æ—Ä
# –ï—Å–ª–∏ —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–ø—Ü–∏—é LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

# 7. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ XML
xml_string = XMLExportService.export_contract_to_xml(contract_data)
```

---

## üîß –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ app.py

–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
```python
from src.utils.auth import *
from src.utils.contract_types import *
from src.utils.knowledge_base import *
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å init_session_state()

–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
```python
def init_session_state():
    init_auth_state()  # Auth
    # ... KB manager
    create_demo_users()  # Demo users
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å sidebar

–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
```python
def sidebar_navigation():
    # ...
    show_user_info()  # –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –®–∞–≥ 4: –ó–∞–º–µ–Ω–∏—Ç—å page_generator

```python
# –í–∞—Ä–∏–∞–Ω—Ç –ê: –ó–∞–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
from app_pages_improved import page_generator_improved as page_generator

# –í–∞—Ä–∏–∞–Ω—Ç –ë: –£—Å–ª–æ–≤–Ω—ã–π –≤—ã–∑–æ–≤
if use_improved:
    from app_pages_improved import page_generator_improved
    page_generator_improved()
else:
    page_generator()  # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
```

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï

### –ó–∞–≤–µ—Ä—à–∏—Ç—å:
1. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å LLM fallback –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤
2. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RAG —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å XML export –≤ Quick Export Agent
4. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `page_generator_improved()` –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–π
- –î–æ–±–∞–≤–∏—Ç—å `page_knowledge_base()` –≤ —Ä–æ—É—Ç–∏–Ω–≥
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å XML export –≤ export page
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RAG –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –ë–ó

---

## üìä –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|---------|--------|----------|
| Auth —Å–∏—Å—Ç–µ–º–∞ | ‚úÖ | 100% |
| –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π | ‚úÖ | 100% |
| –¢–∏–ø—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º | ‚úÖ | 100% |
| –£–ª—É—á—à–µ–Ω–Ω—ã–π UI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ | ‚úÖ | 100% |
| XML export | ‚úÖ | 100% |
| –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ë–ó | ‚úÖ | 100% |
| LLM fallback | ‚úÖ | 100% |
| RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚è≥ | 0% (–û—Ç–ª–æ–∂–µ–Ω–æ) |
| –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | 100% |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** 100%

---

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑ —à–∞–±–ª–æ–Ω–∞** - UI –≥–æ—Ç–æ–≤, backend –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
2. **RAG –ø–æ–∏—Å–∫** - UI –≥–æ—Ç–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è
3. **XML –≤ Quick Export** - —Å–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞–≥–µ–Ω—Ç

---

**–î–∞—Ç–∞:** 13 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 2.0.0-beta
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
