# üìä Contract AI System - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-08
**–í–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** `claude/plan-idp-integration-2rpCO`
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã 2.0

---

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤:
- **Pre-Execution:** –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–∞–º–∏, —Ä–∏—Å–∫-—Å–∫–æ—Ä–∏–Ω–≥, –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π
- **Post-Execution:** –¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 2.0 - –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Multi-Model Routing Strategy
- **DeepSeek-V3** ‚Üí 90% –∑–∞–¥–∞—á, $0.14/1M —Ç–æ–∫–µ–Ω–æ–≤ (–æ—Å–Ω–æ–≤–Ω–æ–π movement)
- **Claude 4.5 Sonnet** ‚Üí 10% –∑–∞–¥–∞—á (—Å–ª–æ–∂–Ω—ã–µ —Å–∫–∞–Ω—ã, –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ), $3.00/1M —Ç–æ–∫–µ–Ω–æ–≤
- **GPT-4o** ‚Üí –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª, $2.50/1M —Ç–æ–∫–µ–Ω–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è:** –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å $0.50 ‚Üí $0.02

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è —Å—Ö–µ–º–∞:** PostgreSQL 16+ (SQL –¥–ª—è —è–¥—Ä–∞ + JSONB –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)
- **–ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
  - `contracts_core` - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å JSONB attributes + raw_data
  - `contract_rules` - –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (—à—Ç—Ä–∞—Ñ—ã, SLA) –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONB
  - `contract_parties`, `contract_items`, `payment_schedule` - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫:** pgvector (embedding vector(1536))

### Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏
1. **OCR/Layout:** PaddleOCR + LayoutLMv3
2. **Level 1:** Regex/SpaCy (–¥–∞—Ç—ã, –ò–ù–ù, —Å—É–º–º—ã) - –±–µ—Å–ø–ª–∞—Ç–Ω–æ
3. **Level 2:** LLM —á–µ—Ä–µ–∑ Smart Router - —Ç–∞–±–ª–∏—Ü—ã, —É—Å–ª–æ–≤–∏—è, —Ä–∏—Å–∫–∏

---

## üìã –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (20 –Ω–µ–¥–µ–ª—å, 5 —ç—Ç–∞–ø–æ–≤)

### Stage 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ù–µ–¥–µ–ª–∏ 1-2)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î: –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (contracts_core, contract_rules –∏ –¥—Ä.)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pgvector —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è API: DeepSeek-V3 + Anthropic Claude
- [ ] –ë–∞–∑–æ–≤—ã–π Smart Router (–∑–∞–≥–ª—É—à–∫–∞)

### Stage 1: Post-Execution MVP (–ù–µ–¥–µ–ª–∏ 3-6)
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ DeepSeek-V3
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ contracts_core (JSONB format)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è Pydantic-—Å—Ö–µ–º–∞–º–∏
- [ ] API endpoints: `/contracts/digitize`, `/contracts/{id}/structured`

### Stage 2: Pre-Execution (–ù–µ–¥–µ–ª–∏ 7-10)
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–∞–º–∏/Playbook
- [ ] Risk Scoring Engine
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π
- [ ] API endpoints: `/negotiation/upload`, `/negotiation/{id}/disagreements`

### Stage 3: Smart Router Production (–ù–µ–¥–µ–ª–∏ 11-14)
- [ ] –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (complexity_score)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ DeepSeek ‚Üî Claude
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (force_model parameter)
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- [ ] Fallback –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏

### Stage 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ + UI (–ù–µ–¥–µ–ª–∏ 15-20)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ø. —Å–æ–≥–ª–∞—à–µ–Ω–∏–π (Amendment flow)
- [ ] –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (pgvector)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1C/ERP (export/import)
- [ ] UI –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤: —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π
- [ ] Dashboard: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ä–æ–∫–æ–≤, –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤

---

## üîÑ Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **Claude Code:** –ü–∏—à–µ—Ç –∫–æ–¥, —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–º–∏—Ç—ã
2. **Push:** `git push -u origin claude/plan-idp-integration-2rpCO`
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `git pull origin claude/plan-idp-integration-2rpCO`
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø—É—Å–∫ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:** –ö–æ–º–∞–Ω–¥—ã –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

---

## üìÅ –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Contract-AI-System-/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/contracts/routes.py          # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints
‚îÇ   ‚îú‚îÄ‚îÄ models/database.py               # –°—Ç–∞—Ä—ã–µ –º–æ–¥–µ–ª–∏ (Contract, AnalysisResult)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document_parser.py           # DOCX/PDF –ø–∞—Ä—Å–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (–ù–û–í–û–ï) idp_orchestrator.py  # –ë—É–¥—É—â–∏–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä IDP
‚îÇ   ‚îú‚îÄ‚îÄ agents/contract_analyzer_agent.py # Multi-agent —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ       ‚îî‚îÄ‚îÄ (–ù–û–í–û–ï) idp_schemas.py       # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ alembic/versions/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ IDP_INTEGRATION_CONCEPT.md       # –°—Ç–∞—Ä–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è (—É—Å—Ç–∞—Ä–µ–ª–∞)
‚îÇ   ‚îî‚îÄ‚îÄ (–ù–û–í–û–ï) ARCHITECTURE_V2.md       # –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îî‚îÄ‚îÄ current.md                           # –≠–¢–û–¢ –§–ê–ô–õ
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

1. **–ö–û–î –ü–ò–®–ï–¢–°–Ø –¢–û–õ–¨–ö–û –ü–û –ö–û–ú–ê–ù–î–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø!**
2. –§–∞–π–ª `current.md` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–∞—É–∑—ã
3. –≠—Ç–æ—Ç —Ñ–∞–π–ª –ù–ï —Ä–∞—Å—Ç–µ—Ç, –∞ –û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø (–ø—Ä–æ–≥—Ä–µ—Å—Å, —Å—Ç–∞—Ç—É—Å—ã —á–µ–∫-–ø–æ–∏–Ω—Ç–æ–≤)
4. –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º Stage - —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–∏–º–æ–≥–æ –∫–æ–º–º–∏—Ç–∞

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:** Stage 0 (–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
**–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** 0/5 —ç—Ç–∞–ø–æ–≤
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** FastAPI (Python 3.11+)
- **Database:** PostgreSQL 16+ (pgvector extension)
- **ORM:** SQLAlchemy 2.x
- **Validation:** Pydantic v2
- **OCR:** PaddleOCR + LayoutLMv3
- **NLP:** SpaCy (Level 1 extraction)
- **LLM:** DeepSeek-V3 (primary), Claude 4.5 Sonnet (fallback), GPT-4o (reserve)
- **Vector DB:** pgvector (PostgreSQL extension)
- **Queue:** Redis + Celery (–¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)

---

## üìù Intermediate JSON Format

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–±–º–µ–Ω–∞ –º–µ–∂–¥—É AI –∏ –ë–î:

```json
{
  "metadata": { "doc_type": "supply", "confidence": 0.95 },
  "financials": {
    "amount": 100000,
    "currency": "RUB",
    "vat_included": true
  },
  "payment_schedule": [
    { "type": "prepayment", "percent": 30, "due": "2026-02-01" }
  ],
  "rules": [
    {
      "type": "penalty",
      "trigger": "delay",
      "description": "0.1% per day limited to 10%",
      "structured_formula": { "rate": 0.001, "cap": 0.1 }
    }
  ]
}
```
